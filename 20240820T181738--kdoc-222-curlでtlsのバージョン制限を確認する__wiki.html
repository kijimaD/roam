<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-06-27T21:16:49Z -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KDOC 222: curlでTLSのバージョン制限を確認する</title>
<meta name="author" content="kijimaD" />
<meta name="generator" content="Org Mode" />
<link rel='shortcut icon' type='image/x-icon' href='https://kijimad.github.io/roam/favicon.ico' /><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' media='print' onload='this.media="all"' /><link rel='stylesheet' href='https://kijimad.github.io/roam/css/site.css' /><link rel='stylesheet' href='https://kijimad.github.io/roam/css/code.css' /><link rel='preconnect' href='https://fonts.googleapis.com'><link rel='preconnect' href='https://fonts.gstatic.com' crossorigin><link href='https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP&display=swap' rel='stylesheet'>
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content" class="content">
<h1 class="title">KDOC 222: curlでTLSのバージョン制限を確認する</h1>
<div id="outline-container-org400cf78" class="outline-2">
<h2 id="org400cf78"><a href="#org400cf78">この文書のステータス</a></h2>
<div class="outline-text-2" id="text-org400cf78">
<ul class="org-ul">
<li>作成
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-08-22 貴島</li>
</ul></li>
<li>レビュー
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-08-26 貴島</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org0563a87" class="outline-2">
<h2 id="org0563a87"><a href="#org0563a87">概要</a></h2>
<div class="outline-text-2" id="text-org0563a87">
<p>
セキュリティ上の理由で、サーバ側でTLSの古いバージョンのリクエストを受け付けなくすることがある。設定後、<a href="20240210130812-curl.html#ID-b11fb9a4-0a26-4354-bc60-6c755c256b21">curl</a>で確かめる方法を確認する。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>TLSバージョン1.2を上限に設定する。TLS1.2を使用し、成功する</label><pre class="src src-shell">curl -v --tls-max 1.2 https://www.fsa.go.jp/ -I
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>実行結果</label><pre class="src src-shell">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Host www.fsa.go.jp:443 was resolved.
* IPv6: (none)
* IPv4: 3.166.244.76, 3.166.244.80, 3.166.244.77, 3.166.244.84
*   Trying 3.166.244.76:443...
* Connected to www.fsa.go.jp (3.166.244.76) port 443
* found 158 certificates<span class="org-keyword"> in</span> /home/orange/.guix-profile/etc/ssl/certs/ca-certificates.crt
* found 474 certificates<span class="org-keyword"> in</span> /home/orange/.guix-profile/etc/ssl/certs
* GnuTLS ciphers: NORMAL:-ARCFOUR-128:-CTYPE-ALL:+CTYPE-X509:-VERS-SSL3.0:-VERS-TLS-ALL:+VERS-TLS1.2:+VERS-TLS1.1:+VERS-TLS1.0
* ALPN: curl offers h2,http/1.1
* SSL connection using TLS1.2 / ECDHE_RSA_AES_128_GCM_SHA256
*   server certificate verification OK
*   server certificate status verification SKIPPED
*   common name: www.fsa.go.jp (matched)
*   server certificate expiration date OK
*   server certificate activation date OK
*   certificate public key: RSA
*   certificate version: <span class="org-comment-delimiter">#</span><span class="org-comment">3</span>
*   subject: <span class="org-variable-name">C</span>=JP,<span class="org-variable-name">ST</span>=Tokyo-to,<span class="org-variable-name">L</span>=Chiyoda-ku,<span class="org-variable-name">O</span>=Financial Services Agency,<span class="org-variable-name">CN</span>=www.fsa.go.jp
*   start date: Wed, 05 Jun 2024 06:40:28 GMT
*   expire date: Sat, 28 Jun 2025 14:59:59 GMT
*   issuer: <span class="org-variable-name">C</span>=JP,<span class="org-variable-name">O</span>=SECOM Trust Systems CO.<span class="org-string">\,</span>LTD.,<span class="org-variable-name">CN</span>=SECOM Passport for Web SR 3.0 CA
* ALPN: server accepted h2
* using HTTP/2
* [HTTP/2] [1] OPENED stream for https://www.fsa.go.jp/
* [HTTP/2] [1] [:method: HEAD]
* [HTTP/2] [1] [:scheme: https]
* [HTTP/2] [1] [:authority: www.fsa.go.jp]
* [HTTP/2] [1] [:path: /]
* [HTTP/2] [1] [user-agent: curl/8.5.0]
* [HTTP/2] [1] [accept: */*]
&gt; HEAD / HTTP/2
&gt; Host: www.fsa.go.jp
&gt; User-Agent: curl/8.5.0
&gt; Accept: */*
&gt;
&lt; HTTP/2 200
&lt; content-type: text/html
&lt; content-length: 16891
&lt; date: Tue, 20 Aug 2024 09:21:14 GMT
&lt; server: Apache
&lt; last-modified: Mon, 29 Jul 2024 04:09:01 GMT
&lt; accept-ranges: bytes
&lt; x-frame-options: SAMEORIGIN
&lt; x-xss-protection: 1; <span class="org-variable-name">mode</span>=block
&lt; x-content-type-options: nosniff
&lt; vary: Accept-Encoding
&lt; x-cache: Hit from cloudfront
&lt; via: 1.1 f93e179d1b1a552c89c83ee369ac624a.cloudfront.net (CloudFront)
&lt; x-amz-cf-pop: NRT20-P6
&lt; x-amz-cf-id: <span class="org-variable-name">YPb7msF24vcjjbBzuprNX6kKyClkEE0wj0Mk2QcZnOCPFB2HhbzWhg</span>==
&lt; age: 107044
&lt;
0 16891    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Connection <span class="org-comment-delimiter">#</span><span class="org-comment">0 to host www.fsa.go.jp left intact</span>
[ Babel evaluation exited with code 0 ]
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>TLSバージョン1.0を上限に設定する。TLS1.0を使用し、失敗する</label><pre class="src src-shell">curl -v --tls-max 1.0 https://www.fsa.go.jp/ -I
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>実行結果。Error in protocol versionを確認できる</label><pre class="src src-shell">% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Host www.fsa.go.jp:443 was resolved.
* IPv6: (none)
* IPv4: 3.166.244.80, 3.166.244.76, 3.166.244.77, 3.166.244.84
*   Trying 3.166.244.80:443...
* Connected to www.fsa.go.jp (3.166.244.80) port 443
* found 158 certificates<span class="org-keyword"> in</span> /home/orange/.guix-profile/etc/ssl/certs/ca-certificates.crt
* found 474 certificates<span class="org-keyword"> in</span> /home/orange/.guix-profile/etc/ssl/certs
* GnuTLS ciphers: ,NORMAL:-ARCFOUR-128:-CTYPE-ALL:+CTYPE-X509:-VERS-SSL3.0:-VERS-TLS-ALL:+VERS-TLS1.0
* ALPN: curl offers h2,http/1.1
* gnutls_handshake() failed: Error<span class="org-keyword"> in</span> protocol version
0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Closing connection
curl: (35) gnutls_handshake() failed: Error<span class="org-keyword"> in</span> protocol version
[ Babel evaluation exited with code 35 ]
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc017e22" class="outline-2">
<h2 id="orgc017e22"><a href="#orgc017e22">参考</a></h2>
<div class="outline-text-2" id="text-orgc017e22">
<ul class="org-ul">
<li><a href="https://qiita.com/daji110728/items/ec400d0268c76cc1dc04">curlコマンドでTLSバージョンを指定する方法 #ALB - Qiita</a></li>
</ul>
</div>
</div>
<div id="outline-container-org7d10c48" class="outline-2">
<h2 id="org7d10c48"><a href="#org7d10c48">関連</a></h2>
<div class="outline-text-2" id="text-org7d10c48">
<p>
なし。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer>
</div>
</body>
</html>
