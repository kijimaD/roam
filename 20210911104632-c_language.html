<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-06-27T21:20:04Z -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>C言語</title>
<meta name="author" content="kijimaD" />
<meta name="generator" content="Org Mode" />
<link rel='shortcut icon' type='image/x-icon' href='https://kijimad.github.io/roam/favicon.ico' /><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' media='print' onload='this.media="all"' /><link rel='stylesheet' href='https://kijimad.github.io/roam/css/site.css' /><link rel='stylesheet' href='https://kijimad.github.io/roam/css/code.css' /><link rel='preconnect' href='https://fonts.googleapis.com'><link rel='preconnect' href='https://fonts.gstatic.com' crossorigin><link href='https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP&display=swap' rel='stylesheet'>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content" class="content">
<h1 class="title">C言語</h1>
<div id="outline-container-orge3861d5" class="outline-2">
<h2 id="orge3861d5"><a href="#orge3861d5">概要</a></h2>
<div class="outline-text-2" id="text-orge3861d5">
<p>
C言語は汎用の<a href="20210509101246-programming_language.html#ID-868ac56a-2d42-48d7-ab7f-7047c85a8f39">Programming Language</a>。OS、プログラミング言語、ハードウェアとの接続といった基盤的な部分で使われる。
</p>

<p>
たとえば。
</p>

<ul class="org-ul">
<li><a href="20220108110637-linux.html#ID-7a81eb7c-8e2b-400a-b01a-8fa597ea527a">Linux</a></li>
<li><a href="20210509095513-ruby.html#ID-cfd092c4-1bb2-43d3-88b1-9f647809e546">Ruby</a></li>
<li><a href="20210725134208-python.html#ID-a6c9c9ad-d9b1-4e13-8992-75d8590e464c">Python</a></li>
<li><a href="20210508234743-emacs.html#ID-1ad8c3d5-97ba-4905-be11-e6f2626127ad">Emacs</a></li>
</ul>

<p>
現在基盤として使われている多くのプログラムがCで書かれていて、<a href="20210926150327-oss.html#ID-bb71747d-8599-4aee-b747-13cb44c05773">OSS</a>として公開されている。別の言語で書くにしても、既存の巨大なコード群を参考にできるのは大きな利点。
</p>
</div>
</div>
<div id="outline-container-org13a868e" class="outline-2">
<h2 id="org13a868e"><a href="#org13a868e">Memo</a></h2>
<div class="outline-text-2" id="text-org13a868e">
</div>
<div id="outline-container-orgf94b3aa" class="outline-3">
<h3 id="orgf94b3aa"><a href="#orgf94b3aa">ラインエディタedのメイン関数</a></h3>
<div class="outline-text-3" id="text-orgf94b3aa">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>割り込み処理などを見ることができる</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/bin/ed/main.c#L113
</pre>
</div>

<div class="results" id="orge80eeb1">
<p>
main(int ac, char *av[])
</p>

</div>
</div>
</div>
<div id="outline-container-org8a9168c" class="outline-3">
<h3 id="org8a9168c"><a href="#org8a9168c">シグナル</a></h3>
<div class="outline-text-3" id="text-org8a9168c">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>シグナルによって中断を検知する</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/games/arithmetic/arithmetic.c#L156-L162
</pre>
</div>

<div class="results" id="orgc8711c8">
<p>
<i>* Handle interrupt character.  Print score and exit. *</i>
static void
intr(int dummy __unused)
{
	showstats(1);
	exit(0);
}
</p>

</div>
</div>
</div>
<div id="outline-container-org15f83bc" class="outline-3">
<h3 id="org15f83bc"><a href="#org15f83bc">shellのノード定義</a></h3>
<div class="outline-text-3" id="text-org15f83bc">
<div class="org-src-container">
<pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/bin/sh/nodetypes#L56-L61
</pre>
</div>

<div class="results" id="org2798416">
<p>
NCMD ncmd			# a simple command
	type	  int
	backgnd	  int			# set to run command in background
	args	  nodeptr		# the arguments
	redirect  nodeptr		# list of file redirections
	lineno	  int
</p>

</div>
</div>
</div>
<div id="outline-container-orgda6fb9b" class="outline-3">
<h3 id="orgda6fb9b"><a href="#orgda6fb9b">バイナリツリー</a></h3>
<div class="outline-text-3" id="text-orgda6fb9b">
<p>
バイナリツリーの中にはleft, rightを持つものがあり、leftは小さい、rightは大きいとしてノードの順番を決定する。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>バイナリツリーの定義。各ノードはほかのノードを最高2つまで持つことができる</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/external/bsd/libbind/dist/include/isc/tree.h#L44-L49
</pre>
</div>

<div class="results" id="orge1d4c5c">
<p>
typedef	struct tree_s {
		tree_t  data;
		struct tree_s *left, *right;
		short		bal;
	}
	tree;
</p>

</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>ツリー内の要素を再帰的に検索する</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/external/bsd/libbind/dist/isc/tree.c#L105-L130
</pre>
</div>

<div class="results" id="orgb388449">
<p>
tree_t
tree_srch(tree **ppr_tree, int (*pfi_compare)(tree_t, tree_t), tree_t p_user) {
	ENTER(&ldquo;tree_srch&rdquo;)
</p>

<p>
if (*ppr_tree) {
	int i_comp = (*pfi_compare)(p_user, (**ppr_tree).data);
</p>

<p>
if (i_comp &gt; 0)
	RET(tree_srch(&amp;(**ppr_tree).right,
		      pfi_compare,
		      p_user))
</p>

<p>
if (i_comp &lt; 0)
	RET(tree_srch(&amp;(**ppr_tree).left,
		      pfi_compare,
		      p_user))
</p>

<p>
	<i>* not higher, not lower&#x2026; this must be the one.
	 *</i>
	RET((**ppr_tree).data)
}
</p>

<p>
	<i>* grounded. NOT found.
	 *</i>
	RET(NULL)
}
</p>

</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>系統的にツリーをたどる</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/external/bsd/libbind/dist/isc/tree.c#L155-L169
</pre>
</div>

<div class="results" id="orgacedffb">
<p>
int
tree_trav(tree **ppr_tree, int (*pfi_uar)(tree_t)) {
	ENTER(&ldquo;tree_trav&rdquo;)
</p>

<p>
if (!*ppr_tree)
	RET(TRUE)
</p>

<p>
	if (!tree_trav(&amp;(**ppr_tree).left, pfi_uar))
		RET(FALSE)
	if (!(*pfi_uar)((**ppr_tree).data))
		RET(FALSE)
	if (!tree_trav(&amp;(**ppr_tree).right, pfi_uar))
		RET(FALSE)
	RET(TRUE)
}
</p>

</div>

<ul class="org-ul">
<li>ツリーは言語構造の表現ができる</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>lintでの例</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/usr.bin/xlint/lint1/lint1.h#L284-L305
</pre>
</div>

<div class="results" id="org483f485">
<p>
typedef	struct tnode {
	op_t tn_op;		<i>* operator *</i>
	type_t <b>tn_type;	/</b> type <b>/
	bool	tn_lvalue:1;	/</b> node is lvalue <b>/
	bool	tn_cast:1;	/</b> if tn_op == CVT, it&rsquo;s an explicit cast <b>/
	bool	tn_parenthesized:1;
	bool	tn_sys:1;	/</b> in strict bool mode, allow mixture between
</p>
<ul class="org-ul">
<li>bool and scalar, for code from system</li>
<li>headers that may be a mixture between</li>
<li>scalar types and bool</li>
</ul>
<p>
				 <b>/
	bool	tn_system_dependent:1; /</b> depends on sizeof or offsetof <b>/
	union {
		struct {
			struct	tnode *_tn_left;	/</b> (left) operand <b>/
			struct	tnode *_tn_right;	/</b> right operand <b>/
		} tn_s;
		sym_t *_tn_sym;	/</b> symbol if op <code>= NAME */
		val_t	*_tn_val;	/* value if op =</code> CON <b>/
		strg_t *_tn_string;	/</b> string if op == STRING */
	} tn_u;
} tnode_t;
</p>

</div>
</div>
</div>
<div id="outline-container-org9e41961" class="outline-3">
<h3 id="org9e41961"><a href="#org9e41961">ハッシュテーブルエントリに複数の要素を格納する</a></h3>
<div class="outline-text-3" id="text-org9e41961">
<p>
シンボルテーブルの構築によく使われる。
</p>

<div class="org-src-container">
<pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/games/battlestar/parse.c#L75-L84
</pre>
</div>

<div class="results" id="org9ca5f93">
<p>
static struct wlist *
lookup(const char   *s)
{
	struct wlist *wp;
</p>

<p>
	for (wp = hashtab[hash(s)]; wp != NULL; wp = wp-&gt;next)
		if (*s <code>= *wp-&gt;string &amp;&amp; strcmp(s, wp-&gt;string) =</code> 0)
			return wp;
	return NULL;
}
</p>

</div>
</div>
</div>
<div id="outline-container-orgc4dd06f" class="outline-3">
<h3 id="orgc4dd06f"><a href="#orgc4dd06f">循環リスト実装</a></h3>
<div class="outline-text-3" id="text-orgc4dd06f">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>終端がないので、forを使えない。最初の要素を保存して、同じ要素にあたるまでループする</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/bin/csh/lex.c#L176-L189
</pre>
</div>

<div class="results" id="orgb504c15">
<p>
prlex(FILE *fp, struct wordent *sp0)
{
    struct wordent *sp;
</p>

<p>
    sp = sp0-&gt;next;
    for (;;) {
	(void)fprintf(fp, &ldquo;%s&rdquo;, vis_str(sp-&gt;word));
	sp = sp-&gt;next;
	if (sp <code>= sp0)
	    break;
	if (sp-&gt;word[0] !</code> &rsquo;\n&rsquo;)
	    (void) fputc(&rsquo; &rsquo;, fp);
    }
}
</p>

</div>
</div>
</div>
<div id="outline-container-orga460563" class="outline-3">
<h3 id="orga460563"><a href="#orga460563">リスト処理</a></h3>
<div class="outline-text-3" id="text-orga460563">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>host_listを定義</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/usr.bin/rup/rup.c#L63-L70
</pre>
</div>

<div class="results" id="orgde3b938">
<p>
static struct host_list {
	struct host_list *next;
	int family;
	union {
		struct in6_addr _addr6;
		struct in_addr _addr4;
	} addr;
} *hosts;
</p>

</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>リストを辿りforで処理する</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/usr.bin/rup/rup.c#L79-L105
</pre>
</div>

<div class="results" id="org0d5ac60">
<p>
search_host(struct sockaddr *sa)
{
	struct host_list *hp;
</p>

<p>
if (!hosts)
	return 0;
</p>

<p>
	for (hp = hosts; hp != NULL; hp = hp-&gt;next) {
		switch (hp-&gt;family) {
		case AF_INET6:
			if (!memcmp(&amp;hp-&gt;addr6,
			    &amp;((struct sockaddr_in6 *)(void *)sa)-&gt;sin6_addr,
			    sizeof (struct in6_addr)))
				return 1;
			break;
		case AF_INET:
			if (!memcmp(&amp;hp-&gt;addr4,
			    &amp;((struct sockaddr_in *)(void *)sa)-&gt;sin_addr,
			    sizeof (struct in_addr)))
				return 1;
			break;
		default:
			break;
		}
	}
	return 0;
}
</p>

</div>

<p>
nextという要素を持つ構造体は1方向リスト連結リストのノードを定義する。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>nextを追加して辿れるようにする</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/usr.bin/rup/rup.c#L108-L134
</pre>
</div>

<div class="results" id="org5a6dac9">
<p>
remember_host(struct sockaddr *sa)
{
	struct host_list *hp;
</p>

<p>
	if ((hp = malloc(sizeof(struct host_list))) == NULL) {
		err(1, &ldquo;malloc&rdquo;);
		<i>* NOTREACHED *</i>
	}
	hp-&gt;family = sa-&gt;sa_family;
	hp-&gt;next = hosts;
	switch (sa-&gt;sa_family) {
	case AF_INET6:
		(void)memcpy(&amp;hp-&gt;addr6,
		    &amp;((struct sockaddr_in6 <b>)(void *)sa)-&gt;sin6_addr,
		    sizeof (struct in6_addr));
		break;
	case AF_INET:
		(void)memcpy(&amp;hp-&gt;addr4,
		    &amp;((struct sockaddr_in *)(void *)sa)-&gt;sin_addr,
		    sizeof (struct in_addr));
		break;
	default:
		errx(1, &ldquo;unknown address family&rdquo;);
		/</b> NOTREACHED */
	}
	hosts = hp;
}
</p>

</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 12: </span>ダブル連結リストから要素epを削除</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/usr.bin/telnet/commands.c#L1700-L1716
</pre>
</div>

<div class="results" id="org5c81bd5">
<p>
struct env_lst *
env_undefine(const char *var, char *d)
{
	struct env_lst *ep;
</p>

<p>
	if ((ep = env_find(var)) != NULL) {
		ep-&gt;prev-&gt;next = ep-&gt;next;
		if (ep-&gt;next)
			ep-&gt;next-&gt;prev = ep-&gt;prev;
		if (ep-&gt;var)
			free(ep-&gt;var);
		if (ep-&gt;value)
			free(ep-&gt;value);
		free(ep);
	}
	return NULL;
}
</p>

</div>
</div>
</div>
<div id="outline-container-org661e657" class="outline-3">
<h3 id="org661e657"><a href="#org661e657">配列定義</a></h3>
<div class="outline-text-3" id="text-org661e657">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 13: </span>配列要素があらかじめわかっている場合の初期化</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/lib/libc/time/localtime.c#L869-L871
</pre>
</div>

<div class="results" id="orgbe33b12">
<p>
static const int	year_lengths[2] = {
	DAYSPERNYEAR, DAYSPERLYEAR
};
</p>

</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 14: </span>通常の年と潤年の日数</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/lib/libc/time/localtime.c#L864-L867
</pre>
</div>

<div class="results" id="orgf34d276">
<p>
static const int	mon_lengths[2][MONSPERYEAR] = {
	{ 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 },
	{ 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31 }
};
</p>

</div>
</div>
</div>
<div id="outline-container-orgf13c287" class="outline-3">
<h3 id="orgf13c287"><a href="#orgf13c287">データの内部構造を表現する</a></h3>
<div class="outline-text-3" id="text-orgf13c287">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 15: </span>tarが各ファイルの情報を表現するために使用する構造体</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/external/bsd/file/dist/src/tar.h#L53-L71
</pre>
</div>

<div class="results" id="orgf2c6626">
<p>
union record {
	unsigned char	charptr[RECORDSIZE];
	struct header {
		char	name[NAMSIZ];
		char	mode[8];
		char	uid[8];
		char	gid[8];
		char	size[12];
		char	mtime[12];
		char	chksum[8];
		char	linkflag;
		char	linkname[NAMSIZ];
		char	magic[8];
		char	uname[TUNMLEN];
		char	gname[TGNMLEN];
		char	devmajor[8];
		char	devminor[8];
	} header;
};
</p>

</div>
</div>
</div>
<div id="outline-container-org8221d27" class="outline-3">
<h3 id="org8221d27"><a href="#org8221d27">多態の実装</a></h3>
<div class="outline-text-3" id="text-org8221d27">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 16: </span>データの種類を定義。名前にtypeをつける慣例</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/include/rpc/rpc_msg.h#L54-L57
</pre>
</div>

<div class="results" id="org9f48c0c">
<p>
enum msg_type {
	CALL=0,
	REPLY=1
};
</p>

</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 17: </span>msg_typeで2つの型が識別される</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/include/rpc/rpc_msg.h#L149-L155
</pre>
</div>

<div class="results" id="org18a9bdb">
<p>
struct rpc_msg {
	uint32_t  rm_xid;
	enum msg_type  rm_direction;
	union {
		struct call_body RM_cmb;
		struct reply_body RM_rmb;
	} ru;
</p>

</div>
</div>
</div>
<div id="outline-container-org5b9d07f" class="outline-3">
<h3 id="org5b9d07f"><a href="#org5b9d07f">共用体の使用例</a></h3>
<div class="outline-text-3" id="text-org5b9d07f">
<p>
共用体はメモリを共用し、節約するために用いる。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 18: </span>mallocのコードから</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/lib/libbsdmalloc/malloc.c#L75-L89
</pre>
</div>

<div class="results" id="org4b56eba">
<p>
union	overhead {
	union	overhead <b>ov_next;	/</b> when free <b>/
	struct {
		u_char ovu_magic;	/</b> magic number <b>/
		u_char ovu_index;	/</b> bucket # <b>/
#ifdef RCHECK
		u_short ovu_rmagic;	/</b> range magic number <b>/
		u_long ovu_size;	/</b> actual block size */
#endif
	} ovu;
#define	ov_magic ovu.ovu_magic
#define	ov_index ovu.ovu_index
#define	ov_rmagic ovu.ovu_rmagic
#define	ov_size  ovu.ovu_size
};
</p>

</div>

<p>
空き状態と専有状態を同時にとることはないので、同じメモリ空間を共用できる。
</p>
</div>
</div>
<div id="outline-container-orgc50773a" class="outline-3">
<h3 id="orgc50773a"><a href="#orgc50773a">構造体の使用例</a></h3>
<div class="outline-text-3" id="text-orgc50773a">
<p>
外部媒体のデータ構造を表現するために構造体が用いられる。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 19: </span>ネットワークインターフェースカードのコマンドブロックのデータ構造</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/sys/dev/ic/i82557reg.h#L147-L151
</pre>
</div>

<div class="results" id="org826bf70">
<p>
struct fxp_cb_nop {
	volatile uint16_t cb_status;
	volatile uint16_t cb_command;
	volatile uint32_t link_addr;
};
</p>

</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 20: </span>TCPパケットヘッダの定義</label><pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/external/bsd/tcpdump/dist/tcp.h#L37-L47
</pre>
</div>

<div class="results" id="org2d694a3">
<p>
struct tcphdr {
	uint16_t th_sport;		<i>* source port *</i>
	uint16_t th_dport;		<i>* destination port *</i>
	tcp_seq  th_seq;			<i>* sequence number *</i>
	tcp_seq  th_ack;			<i>* acknowledgement number *</i>
	uint8_t  th_offx2;		<i>* data offset, rsvd *</i>
	uint8_t  th_flags;
	uint16_t th_win;			<i>* window *</i>
	uint16_t th_sum;			<i>* checksum *</i>
	uint16_t th_urp;			<i>* urgent pointer *</i>
} UNALIGNED;
</p>

</div>
</div>
</div>
<div id="outline-container-orgdfc9572" class="outline-3">
<h3 id="orgdfc9572"><a href="#orgdfc9572">strlenの実装</a></h3>
<div class="outline-text-3" id="text-orgdfc9572">
<div class="org-src-container">
<pre class="src src-git-permalink">https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/common/lib/libc/string/strlen.c#L49-L56
</pre>
</div>

<div class="results" id="orgc53bc1a">
<p>
strlen(const char *str)
{
	const char *s;
</p>

<p>
	for (s = str; *s; ++s)
		continue;
	return(s - str);
}
</p>

</div>

<p>
ポインタを文字列の終端に達するまでインクリメントして、先頭のアドレスを差し引く。
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;string.h&gt;</span>
<span class="org-type">int</span> <span class="org-function-name">test_strlen</span>(<span class="org-type">char</span> *<span class="org-variable-name">str</span>) <span class="org-comment-delimiter">// </span><span class="org-comment">str&#12399;&#20808;&#38957;&#12398;&#12450;&#12489;&#12524;&#12473;</span>
{
  <span class="org-type">char</span> *<span class="org-variable-name">s</span>;

  <span class="org-keyword">for</span> (s = str; *s; ++s)
    <span class="org-keyword">continue</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">&#35201;&#32032;&#12398;&#25968;&#12384;&#12369;&#12452;&#12531;&#12463;&#12522;&#12513;&#12531;&#12488;</span>
  <span class="org-keyword">return</span>(s - str); <span class="org-comment-delimiter">// </span><span class="org-comment">&#36914;&#12435;&#12384;&#20998;&#12434;&#27714;&#12417;&#12427;</span>
}
</pre>
</div>

<div class="results" id="orga9e306b">

</div>
</div>
</div>
<div id="outline-container-org4986908" class="outline-3">
<h3 id="org4986908"><a href="#org4986908">無限ループのイディオム</a></h3>
<div class="outline-text-3" id="text-org4986908">
<p>
無限ループの書き方。条件を指定しない。
</p>

<div class="org-src-container">
<pre class="src src-git-permalink">https://github.com/kd-collective/emacs/blob/d983e080e027bd7b680b1e40ccfa0c71d6a3cd94/lib-src/emacsclient.c#L275-L286
</pre>
</div>

<div class="results" id="orgeafe156">
<p>
for (;;)
  {
    char *buf = malloc (buf_size);
    if (!buf)
      return NULL;
    if (getcwd (buf, buf_size) <code>= buf)
	    return buf;
	  free (buf);
	  if (errno !</code> ERANGE || buf_size <code>= bufsize_max)
	    return NULL;
	  buf_size = buf_size &lt;</code> bufsize_max / 2 ? 2 * buf_size : bufsize_max;
  }
</p>

</div>
</div>
</div>
<div id="outline-container-orgdd3ce0a" class="outline-3">
<h3 id="orgdd3ce0a"><a href="#orgdd3ce0a">配列変数は先頭の要素へのポインタ</a></h3>
<div class="outline-text-3" id="text-orgdd3ce0a">
<p>
配列変数には先頭の要素へのポインタが入っていて、インデックスをその分ずらすことで要素を取得できる。配列が0から始まるのはそのため。
</p>

<ul class="org-ul">
<li>最初の要素は、*doses もしくは doses[0] で取得できる。</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 21: </span>等価なさまざまな表記</label><pre class="src src-C"><span class="org-type">doses</span>[3] == *(doses + 3) == *(3 + doses) == 3[doses]
</pre>
</div>

<div class="results" id="orgebf6481">

</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 22: </span>ポインタをずらすことで、文字列をスキップできる</label><pre class="src src-C"><span class="org-type">void</span> <span class="org-function-name">skip</span>(<span class="org-type">char</span> *<span class="org-variable-name">msg</span>)
{
  puts(msg + 6);
}
<span class="org-type">char</span> *<span class="org-variable-name">msg_from_amy</span> = <span class="org-string">"Dont call me"</span>;
<span class="org-function-name">skip</span>(msg_from_amy);
</pre>
</div>

<div class="results" id="org2c4db19">
<p>
all me
</p>

</div>
</div>
</div>
<div id="outline-container-org5372ac2" class="outline-3">
<h3 id="org5372ac2"><a href="#org5372ac2">引数の渡し方</a></h3>
<div class="outline-text-3" id="text-org5372ac2">
<p>
関数呼び出しのとき、デフォルトは値渡しで、コピーされた値が使用される。コピーされるので、呼び出し元の引数の値は変化しない。変化させたいときは、参照を渡す必要がある。
</p>
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 23: </span>main内で座標を保持して、移動するための関数で座標を変化させるような場合、参照渡しでないといけない。</label><pre class="src src-C"><span class="org-type">void</span> <span class="org-function-name">move</span>(<span class="org-type">int</span> *<span class="org-variable-name">lat</span>, <span class="org-type">int</span> *<span class="org-variable-name">lon</span>) {
  *lat = *lat + 1; <span class="org-comment-delimiter">// </span><span class="org-comment">&#24341;&#25968;&#12391;&#28193;&#12373;&#12428;&#12383;lat&#12395;&#12399;&#12513;&#12514;&#12522;&#12450;&#12489;&#12524;&#12473;&#12364;&#20837;&#12387;&#12390;&#12356;&#12427;&#12398;&#12391;&#12289;&#26684;&#32013;&#12375;&#12390;&#12356;&#12427;&#20516;&#12434;&#35501;&#12415;&#36796;&#12416;&#12383;&#12417;&#12395;*&#12434;&#20351;&#12358;&#12290;</span>
  *lon = *lon + 1;
}

<span class="org-type">int</span> <span class="org-function-name">main</span>() {
  <span class="org-type">int</span> <span class="org-variable-name">latitude</span> = 32;
  <span class="org-type">int</span> <span class="org-variable-name">longitude</span> = 64;
  move(&amp;latitude, &amp;longitude); <span class="org-comment-delimiter">// </span><span class="org-comment">&#21442;&#29031;&#12434;&#28193;&#12377;&#12290;&#21442;&#29031;&#12391;&#12394;&#12356;&#22580;&#21512;&#12289;&#21336;&#12394;&#12427;&#20516;&#12398;&#12467;&#12500;&#12540;&#12392;&#12394;&#12387;&#12390;&#12289;move()&#20869;&#12391;&#20840;&#12367;&#38306;&#20418;&#12394;&#12356;&#12525;&#12540;&#12459;&#12523;&#22793;&#25968;&#12398;&#20516;&#12364;&#22793;&#12431;&#12427;&#12384;&#12369;&#12395;&#12394;&#12427;&#12290;main()&#20869;&#12398;&#20516;&#12399;&#22793;&#12431;&#12425;&#12394;&#12356;&#12290;</span>
  printf(<span class="org-string">"&#20572;&#27490;...&#29694;&#22312;&#20301;&#32622;&#65306;[%i, %i]\n"</span>, latitude, longitude);
  <span class="org-keyword">return</span> 0;
}
</pre>
</div>

<div class="results" id="org8596156">
<p>
停止&#x2026;現在位置：[33, 65]
</p>

</div>

<p>
渡したメモリ位置を更新する関数といえる。
</p>
</div>
</div>
</div>
<div id="outline-container-org32afb52" class="outline-2">
<h2 id="org32afb52"><a href="#org32afb52">Tasks</a></h2>
<div class="outline-text-2" id="text-org32afb52">
</div>
<div id="outline-container-org692dcd2" class="outline-3">
<h3 id="org692dcd2"><a href="#org692dcd2"><span class="todo TODO">TODO</span> <a href="https://www.amazon.co.jp/C%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0FAQ%E2%80%95C%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AE%E3%82%88%E3%81%8F%E5%B0%8B%E3%81%AD%E3%82%89%E3%82%8C%E3%82%8B%E8%B3%AA%E5%95%8F-%E6%96%B0%E7%B4%80%E5%85%83%E7%A4%BE%E6%83%85%E5%A0%B1%E5%B7%A5%E5%AD%A6%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA-%E3%82%B9%E3%83%86%E3%82%A3%E3%83%BC%E3%83%96-%E3%82%B5%E3%83%9F%E3%83%83%E3%83%88/dp/4775302507">Amazon.co.jp: CプログラミングFAQ: Cプログラミングのよく尋ねられる質問 (新紀元社情報工学シリーズ) : スティーブ サミット, Summit,Steve, 欽一, 北野: 本</a></a></h3>
<div class="outline-text-3" id="text-org692dcd2">
<p>
Cの詳細な解説本。
</p>
</div>
</div>
<div id="outline-container-org8cf9869" class="outline-3">
<h3 id="org8cf9869"><a href="#org8cf9869"><span class="todo TODO">TODO</span> <a href="https://www.amazon.co.jp/%E3%82%A8%E3%82%AD%E3%82%B9%E3%83%91%E3%83%BC%E3%83%88C%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E2%80%95%E7%9F%A5%E3%82%89%E3%82%8C%E3%81%96%E3%82%8BC%E3%81%AE%E6%B7%B1%E5%B1%A4-Ascii-books-%E3%83%94%E3%83%BC%E3%82%BF%E3%83%BC-%E3%83%B4%E3%82%A1%E3%83%B3%E3%83%BB%E3%83%87%E3%83%BB%E3%83%AA%E3%83%B3%E3%83%87%E3%83%B3/dp/4756116396">Amazon.co.jp: エキスパートCプログラミング: 知られざるCの深層</a></a></h3>
<div class="outline-text-3" id="text-org8cf9869">
<p>
Cの解説本。
</p>
</div>
</div>
<div id="outline-container-org9ecddcc" class="outline-3">
<h3 id="org9ecddcc"><a href="#org9ecddcc"><span class="todo TODO">TODO</span> <a href="https://www.amazon.co.jp/C-%E3%81%AE%E8%A8%AD%E8%A8%88%E3%81%A8%E9%80%B2%E5%8C%96-Bjarne-Stroustrup/dp/4797328541">C++の設計と進化 | Bjarne Stroustrup 岩谷 宏 | 本 | 通販 | Amazon</a></a></h3>
<div class="outline-text-3" id="text-org9ecddcc">
<p>
元のコンセプトはシンプルとのこと。
</p>
</div>
</div>
<div id="outline-container-org1dedcf8" class="outline-3">
<h3 id="org1dedcf8"><a href="#org1dedcf8"><span class="todo TODO">TODO</span> <a href="https://9cguide.appspot.com/">総合目次 - 苦しんで覚えるC言語</a></a></h3>
<div class="outline-text-3" id="text-org1dedcf8">
<p>
WEB版の入門書。
</p>
</div>
</div>
<div id="outline-container-org689464d" class="outline-3">
<h3 id="org689464d"><a href="#org689464d"><span class="todo TODO">TODO</span> <a href="https://www.oreilly.co.jp/books/9784873116099/">O&rsquo;Reilly Japan - Head First C</a></a></h3>
<div class="outline-text-3" id="text-org689464d">
<ul class="org-ul">
<li>41, 59, 67, 103, 105</li>
</ul>
<p>
楽しい入門書。
</p>
</div>
</div>
</div>
<div id="outline-container-orgf45235a" class="outline-2">
<h2 id="orgf45235a"><a href="#orgf45235a">Reference</a></h2>
<div class="outline-text-2" id="text-orgf45235a">
</div>
<div id="outline-container-orgb4cfdd7" class="outline-3">
<h3 id="orgb4cfdd7"><a href="#orgb4cfdd7"><a href="https://syohex.hatenablog.com/entry/20100610/1276180481">weakシンボル - Shohei Yoshida&rsquo;s Diary</a></a></h3>
<div class="outline-text-3" id="text-orgb4cfdd7">
<p>
C言語のweakシンボルの使い方。
</p>
</div>
</div>
<div id="outline-container-org2934932" class="outline-3">
<h3 id="org2934932"><a href="#org2934932"><a href="http://www.narihiro.info/g1gc-impl-book/">徹底解剖「G1GC」実装編</a></a></h3>
<div class="outline-text-3" id="text-org2934932">
<p>
GCの実装の解説。
</p>
</div>
</div>
<div id="outline-container-org4a43051" class="outline-3">
<h3 id="org4a43051"><a href="#org4a43051"><a href="https://kuina.ch/l6prog">６さいからのプログラミング</a></a></h3>
<div class="outline-text-3" id="text-org4a43051">
<p>
C言語のチュートリアル。
</p>
</div>
</div>
<div id="outline-container-orgf0b203b" class="outline-3">
<h3 id="orgf0b203b"><a href="#orgf0b203b"><a href="http://www.kouno.jp/home/c_faq/">Language C FAQ</a></a></h3>
<div class="outline-text-3" id="text-orgf0b203b">
<p>
日本語版。
</p>
</div>
</div>
<div id="outline-container-org673c182" class="outline-3">
<h3 id="org673c182"><a href="#org673c182"><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2020/p2137r0.html">P2137R0: Goals and priorities for C++</a></a></h3>
<div class="outline-text-3" id="text-org673c182">
<p>
C++の提案書。
</p>
</div>
</div>
<div id="outline-container-org1368148" class="outline-3">
<h3 id="org1368148"><a href="#org1368148"><a href="http://www.nurs.or.jp/~sug/soft/index.htm">杉浦とソフトウェア開発</a></a></h3>
<div class="outline-text-3" id="text-org1368148">
<p>
なんだかすごい人。
</p>
</div>
</div>
<div id="outline-container-org6550218" class="outline-3">
<h3 id="org6550218"><a href="#org6550218"><a href="http://www.kh.rim.or.jp/~nagamura/misc/stroustrup-interview.html">Bjarne Stroustrup インタビュー (？)</a></a></h3>
<div class="outline-text-3" id="text-org6550218">
<p>
C++の開発者へのインタビュー。
</p>
</div>
</div>
</div>
<div id="outline-container-org8eec1d7" class="outline-2">
<h2 id="org8eec1d7"><a href="#org8eec1d7">Archives</a></h2>
</div>


<div id="outline-container-org1e7e18e" class="outline-2">
<h2 id="org1e7e18e"><a href="#org1e7e18e">Backlinks</a></h2>
<div class="outline-text-2" id="text-org1e7e18e">
<ul class="org-ul">
<li><a href="./20210508234743-emacs.html">Emacs</a></li>
<li><a href="./20210509095513-ruby.html">Ruby</a></li>
<li><a href="./20210829200955-obs.html">OBS</a></li>
<li><a href="./20210907223510-haskell.html">Haskell</a></li>
<li><a href="./20210911113057-go.html">Go</a></li>
<li><a href="./20210915221421-systemcrafters.html">System Crafters</a></li>
<li><a href="./20220108003324-scala.html">Scala</a></li>
<li><a href="./20220328224652-lua.html">Lua</a></li>
<li><a href="./20230815T231456--kdoc-27-cコンパイラを書く__project.html">KDOC 27: Cコンパイラを書く</a></li>
<li><a href="./20231014T171444--kdoc-46-goの宣言構文がcと異なる理由を見る__wiki.html">KDOC 46: Goの宣言構文がCと異なる理由を見る</a></li>
<li><a href="./20240105T215847--kdoc-63-『私はどのようにしてlinuxカーネルを学んだか』__book.html">KDOC 63: 『私はどのようにしてLinuxカーネルを学んだか』</a></li>
<li><a href="./20240301T205049--kdoc-115-負の値が関わる剰余挙動の違い__wiki.html">KDOC 115: 負の値が関わる剰余挙動の違い</a></li>
<li><a href="./20240324T214548--kdoc-129-『ポインタ理解のためのアセンブリ入門』__book.html">KDOC 129: 『ポインタ理解のためのアセンブリ入門』</a></li>
<li><a href="./20240427T120833--kdoc-141-cのポインタ操作をアセンブリで見る__wiki.html">KDOC 141: Cのポインタ操作をアセンブリで見る</a></li>
<li><a href="./20240427T184254--kdoc-143-cの添字記法は単なるシンタックスシュガーである__wiki.html">KDOC 143: Cの添字記法は単なるシンタックスシュガーである</a></li>
<li><a href="./20240617T152502--kdoc-192-『write-great-code-vol1』__draft_book.html">KDOC 192: 『Write Great Code Vol.1』</a></li>
<li><a href="./20240717T223527--kdoc-202-『30日でできる-os自作入門』__book.html">KDOC 202: 『30日でできる! OS自作入門』</a></li>
<li><a href="./20240824T173305--kdoc-225-mallocをアセンブラで見る__wiki.html">KDOC 225: mallocをアセンブラで見る</a></li>
<li><a href="./20240921T003646--kdoc-245-パックしたデータ型がどのように保存されているか見る__wiki.html">KDOC 245: パックしたデータ型がどのように保存されているか見る</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer>
</div>
</body>
</html>
