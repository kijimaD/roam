<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-11-15 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KDOC 142: データセグメントの使い分けを試す</title>
<meta name="author" content="root" />
<meta name="generator" content="Org Mode" />
<link rel='shortcut icon' type='image/x-icon' href='https://kijimad.github.io/roam/favicon.ico' /><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' media='print' onload='this.media="all"' /><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css' media='print' onload='this.media="all"' /><link rel='stylesheet' href='https://kijimad.github.io/roam/css/site.css' /><link rel='stylesheet' href='https://kijimad.github.io/roam/css/code.css' />
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content" class="content">
<h1 class="title">KDOC 142: データセグメントの使い分けを試す</h1>

<div id="outline-container-orgd9fea75" class="outline-2">
<h2 id="orgd9fea75"><a href="#orgd9fea75">この文書のステータス</a></h2>
<div class="outline-text-2" id="text-orgd9fea75">
<ul class="org-ul">
<li>作成
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-04-29 貴島</li>
</ul></li>
<li>レビュー
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-05-06 貴島</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgc733ba6" class="outline-2">
<h2 id="orgc733ba6"><a href="#orgc733ba6">概要</a></h2>
<div class="outline-text-2" id="text-orgc733ba6">
<p>
アセンブラで配列を宣言したときに、データセグメントで確保されたり直にテキストセグメントに現れたりするのを見つけたのでメモしておく<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>。
</p>

<p>
コンパイラによって違うのだろうが、何が根拠になっているのかは今の段階でわかっていない。
</p>
</div>
</div>

<div id="outline-container-org4178fd9" class="outline-2">
<h2 id="org4178fd9"><a href="#org4178fd9">実演</a></h2>
<div class="outline-text-2" id="text-org4178fd9">
<ul class="org-ul">
<li>↓配列要素の長さが4以上になるとデータセグメントで確保される。長さが4より小さいとテキストセグメントで1つずつセットしている。</li>
</ul>

<iframe width="800px" height="200px" src="https://godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,selection:(endColumn:2,endLineNumber:9,positionColumn:2,positionLineNumber:9,selectionStartColumn:2,selectionStartLineNumber:9,startColumn:2,startLineNumber:9),source:'void+main()+%7B%0A++++int+num1%5B3%5D+%3D+%7B1,+2,+3%7D%3B%0A++++int+num2%5B4%5D+%3D+%7B4,+5,+6,+7%7D%3B%0A++++int+num3%5B5%5D+%3D+%7B10,+11,+12,+13,+14%7D%3B%0A++++int+num4%5B%5D+%3D+%7B20,+21,+22%7D%3B%0A++++int+num5%5B%5D+%3D+%7B23,+24,+25,+26%7D%3B%0A++++char+str1%5B%5D+%3D+%22123456789%22%3B%0A++++char+str2%5B%5D+%3D+%221234567890%22%3B%0A%7D'),l:'5',n:'0',o:'C+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:rv32-cgcctrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'1',libraryCode:'0',trim:'0',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,libs:!(),options:'',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:1),l:'5',n:'0',o:'+RISC-V+(32-bits)+gcc+(trunk)+(Editor+%231)',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>

<ul class="org-ul">
<li>↓バイト数が多い型にすると1要素でもデータセグメントで確保された(最後の行)。配列が1要素の場合はなぜかデータセグメントが下に記載された</li>
</ul>

<iframe width="800px" height="200px" src="https://godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,selection:(endColumn:22,endLineNumber:2,positionColumn:22,positionLineNumber:2,selectionStartColumn:22,selectionStartLineNumber:2,startColumn:22,startLineNumber:2),source:'void+main()+%7B%0A++++double+num%5B2%5D+%3D+%7B2.1%7D%3B%0A%7D'),l:'5',n:'0',o:'C+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:rv32-cgcctrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'1',libraryCode:'0',trim:'0',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,libs:!(),options:'',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:1),l:'5',n:'0',o:'+RISC-V+(32-bits)+gcc+(trunk)+(Editor+%231)',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>
</div>
</div>

<div id="outline-container-org9decbe7" class="outline-2">
<h2 id="org9decbe7"><a href="#org9decbe7">関連</a></h2>
<div class="outline-text-2" id="text-org9decbe7">
<ul class="org-ul">
<li><a href="20240427T113714--kdoc-140-『自作エミュレータで学ぶx86アーキテクチャ』__book.html#ID-20240427T113714">KDOC 140: 『自作エミュレータで学ぶx86アーキテクチャ』</a>。読んだ内容を確かめているときに見つけた</li>
</ul>
</div>
</div>

<div id="outline-container-orge7bdc62" class="outline-2">
<h2 id="orge7bdc62"><a href="#orge7bdc62">Backlinks</a></h2>
<div class="outline-text-2" id="text-orge7bdc62">
<ul class="org-ul">
<li><a href="./20240428T105206--kdoc-144-データ型によるサイズの違いを確かめる__wiki.html">KDOC 144: データ型によるサイズの違いを確かめる</a></li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">
対応するドキュメントやコードがどこかにあるはずだが、どう調べればいいかわからなかった。
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"/>
</div>
</body>
</html>
