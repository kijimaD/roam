<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-07-12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KDOC 198: 『ゼロから作るDeep Learning』</title>
<meta name="generator" content="Org mode">
<meta name="author" content="root">
<link rel='shortcut icon' type='image/x-icon' href='/roam/favicon.ico' /><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css' /><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css' /><link rel='stylesheet' href='../css/site.css' /><link rel='stylesheet' href='../roam/css/code.css' /><link rel='stylesheet' href='css/site.css' /><link rel='stylesheet' href='css/code.css' />
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content">
<h1 class="title">KDOC 198: 『ゼロから作るDeep Learning』</h1>

<div id="outline-container-orgff80cc4" class="outline-2">
<h2 id="orgff80cc4"><a href="#orgff80cc4">この文書のステータス</a></h2>
<div class="outline-text-2" id="text-orgff80cc4">
<ul class="org-ul">
<li>作成
<ul class="org-ul">
<li class="off"><input type='checkbox' /> &lt;署名&gt;</li>
</ul></li>
</ul>

<ul class="org-ul">
<li>レビュー
<ul class="org-ul">
<li class="off"><input type='checkbox' /> &lt;署名&gt;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orge694f04" class="outline-2">
<h2 id="orge694f04"><a href="#orge694f04">概要</a></h2>
<div class="outline-text-2" id="text-orge694f04">
<p>
<a href="https://www.oreilly.co.jp/books/9784873117584/">ゼロから作るDeep Learning</a>は、深層学習を実装して学ぶ本。
</p>
</div>
</div>
<div id="outline-container-org82a97e2" class="outline-2">
<h2 id="org82a97e2"><a href="#org82a97e2">メモ</a></h2>
<div class="outline-text-2" id="text-org82a97e2">
<ul class="org-ul">
<li>パーセプトロンの限界は、このように 1 本の直線で分けた領域だけしか表現できない点にある(p30)</li>
<li>パーセプトロンの素晴らしさは、“層を重ねる”ことができる点にある(p31)</li>
<li>行列Aと行列Bの積を計算するとき、Aの列数とBの行数を同じ値にする必要がある
<ul class="org-ul">
<li>A(2x3) と B(3x4) みたいに</li>
</ul></li>
<li>一般的に回帰問題では恒等関数を、分類問題ではソフトマックス関数を使う(p66)</li>
</ul>
</div>
</div>

<div id="outline-container-org0cf2fa8" class="outline-2">
<h2 id="org0cf2fa8"><a href="#org0cf2fa8">実行メモ</a></h2>
<div class="outline-text-2" id="text-org0cf2fa8">
<p>
別のエントリに移動させる。
</p>

<p>
実行の前提。
</p>

<ul class="org-ul">
<li><a href="https://github.com/kijimaD/zerodeep1">https://github.com/kijimaD/zerodeep1</a> を <code>~/Project</code> 下に展開してから実行する</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>NumPy配列との演算</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-variable-name">x</span> = np.array([-1.0, 1.0, 2.0])
<span class="org-keyword">print</span>(x)

<span class="org-variable-name">y</span> = x &gt; 0
<span class="org-keyword">print</span>(y)

<span class="org-variable-name">z</span> = y.astype(<span class="org-builtin">int</span>)
<span class="org-keyword">print</span>(z)
</pre>
</div>

<pre class="example">
[-1.  1.  2.]
[False  True  True]
[0 1 1]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>org-babelで実行が終わらないのでshow()はコメントアウトしている</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">import</span> matplotlib.pylab <span class="org-keyword">as</span> plt

<span class="org-keyword">def</span> <span class="org-function-name">step_function</span>(x):
    <span class="org-keyword">return</span> np.array(x &gt; 0, dtype=<span class="org-builtin">int</span>)

<span class="org-variable-name">x</span> = np.arange(-5.0, 5.0, 0.1)
<span class="org-variable-name">y</span> = step_function(x)
plt.plot(x, y)
plt.ylim(-0.1, 1.1)
<span class="org-comment-delimiter"># </span><span class="org-comment">plt.show()</span>
</pre>
</div>

<pre class="example">

</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>シグモイド関数</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">def</span> <span class="org-function-name">sigmoid</span>(x):
  <span class="org-keyword">return</span> 1 / (1 + np.exp(-x))

<span class="org-keyword">print</span>(sigmoid(-5))
<span class="org-keyword">print</span>(sigmoid(-1))
<span class="org-keyword">print</span>(sigmoid(0))
<span class="org-keyword">print</span>(sigmoid(1))
<span class="org-keyword">print</span>(sigmoid(5))
</pre>
</div>

<pre class="example">
0.0066928509242848554
0.2689414213699951
0.5
0.7310585786300049
0.9933071490757153
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>NumPy配列の演算</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">t</span> = np.array([1.0, 2.0, 3.0])
<span class="org-keyword">print</span>(1.0 + t)
<span class="org-keyword">print</span>(1.0 / t)
</pre>
</div>

<pre class="example">
[2. 3. 4.]
[1.         0.5        0.33333333]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>ReLU関数</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">def</span> <span class="org-function-name">rel</span>(x):
    <span class="org-keyword">return</span> np.maximum(0, x)

<span class="org-keyword">print</span>(rel(-1))
<span class="org-keyword">print</span>(rel(0))
<span class="org-keyword">print</span>(rel(1))
</pre>
</div>

<pre class="example">
0
0
1
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>多次元配列</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">A</span> = np.array([10, 20, 30, 40])
<span class="org-keyword">print</span>(A)
<span class="org-keyword">print</span>(np.ndim(A))
<span class="org-keyword">print</span>(A.shape)
<span class="org-keyword">print</span>(A.shape[0])

<span class="org-keyword">print</span>(<span class="org-string">"================"</span>)

<span class="org-variable-name">B</span> = np.array([[10, 20, 30, 40], [10, 20, 30, 40]])
<span class="org-keyword">print</span>(B)
<span class="org-keyword">print</span>(np.ndim(B))
<span class="org-keyword">print</span>(B.shape)
<span class="org-keyword">print</span>(B.shape[0])
</pre>
</div>

<pre class="example">
[10 20 30 40]
1
(4,)
4
================
[[10 20 30 40]
 [10 20 30 40]]
2
(2, 4)
2
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 7: </span>行列同士の演算</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">A</span> = np.array([[1, 2], [3, 4]])
A.shape

<span class="org-variable-name">B</span> = np.array([[5, 6], [7, 8]])
B.shape

<span class="org-keyword">print</span>(np.dot(A, B))
</pre>
</div>

<pre class="example">
[[19 22]
 [43 50]]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>行列同士の演算では、順番を変えると結果が変わる</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">A</span> = np.array([[1, 2], [3, 4]])
A.shape

<span class="org-variable-name">B</span> = np.array([[7, 8], [5, 6]])
B.shape

<span class="org-keyword">print</span>(np.dot(A, B))
</pre>
</div>

<pre class="example">
[[17 20]
 [41 48]]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>1x2 と 2x3 の積</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-variable-name">X</span> = np.array([1, 2])
<span class="org-keyword">print</span>(X)
<span class="org-variable-name">W</span> = np.array([[1, 3, 5], [2, 4, 8]])
<span class="org-keyword">print</span>(W)

<span class="org-keyword">print</span>(X.shape)
<span class="org-keyword">print</span>(W.shape)
<span class="org-keyword">print</span>(np.dot(X, W))
</pre>
</div>

<pre class="example">
[1 2]
[[1 3 5]
 [2 4 8]]
(2,)
(2, 3)
[ 5 11 21]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>基本式を実装する 1x2 と 2x3</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">def</span> <span class="org-function-name">sigmoid</span>(x):
    <span class="org-keyword">return</span> 1 / (1 + np.exp(-x))

<span class="org-variable-name">X</span> = np.array([1.0, 0.5])
<span class="org-variable-name">W1</span> = np.array([[0.1, 0.3, 0.5], [0.2, 0.4, 0.6]])
<span class="org-variable-name">B1</span> = np.array([0.1, 0.2, 0.3])

<span class="org-keyword">print</span>(X.shape)
<span class="org-keyword">print</span>(W1.shape)
<span class="org-keyword">print</span>(B1.shape)

<span class="org-variable-name">A1</span> = np.dot(X, W1) + B1
<span class="org-variable-name">Z1</span> = sigmoid(A1)
<span class="org-keyword">print</span>(A1)
<span class="org-keyword">print</span>(Z1)
</pre>
</div>

<pre class="example">
(2,)
(2, 3)
(3,)
[0.3 0.7 1.1]
[0.57444252 0.66818777 0.75026011]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>まとめ</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">def</span> <span class="org-function-name">sigmoid</span>(x):
  <span class="org-keyword">return</span> 1 / (1 + np.exp(-x))

<span class="org-keyword">def</span> <span class="org-function-name">identity_function</span>(x):
  <span class="org-keyword">return</span> x

<span class="org-keyword">def</span> <span class="org-function-name">init_network</span>():
  <span class="org-variable-name">network</span> = {}
  <span class="org-variable-name">network</span>[<span class="org-string">'W1'</span>] = np.array([[0.1, 0.3, 0.5], [0.2, 0.4, 0.6]])
  <span class="org-variable-name">network</span>[<span class="org-string">'b1'</span>] = np.array([0.1, 0.2, 0.3])
  <span class="org-variable-name">network</span>[<span class="org-string">'W2'</span>] = np.array([[0.1, 0.4], [0.2, 0.5], [0.3, 0.6]])
  <span class="org-variable-name">network</span>[<span class="org-string">'b2'</span>] = np.array([0.1, 0.2])
  <span class="org-variable-name">network</span>[<span class="org-string">'W3'</span>] = np.array([[0.1, 0.3], [0.2, 0.4]])
  <span class="org-variable-name">network</span>[<span class="org-string">'b3'</span>] = np.array([0.1, 0.2])

  <span class="org-keyword">return</span> network

<span class="org-comment-delimiter"># </span><span class="org-comment">&#20837;&#21147;&#12363;&#12425;&#20986;&#21147;&#26041;&#21521;&#12408;&#12398;&#20253;&#36948;&#20966;&#29702;</span>
<span class="org-keyword">def</span> <span class="org-function-name">forward</span>(network, x):
  <span class="org-variable-name">W1</span>, <span class="org-variable-name">W2</span>, <span class="org-variable-name">W3</span> = network[<span class="org-string">'W1'</span>], network[<span class="org-string">'W2'</span>], network[<span class="org-string">'W3'</span>]
  <span class="org-variable-name">b1</span>, <span class="org-variable-name">b2</span>, <span class="org-variable-name">b3</span> = network[<span class="org-string">'b1'</span>], network[<span class="org-string">'b2'</span>], network[<span class="org-string">'b3'</span>]

  <span class="org-variable-name">a1</span> = np.dot(x, W1) + b1
  <span class="org-variable-name">z1</span> = sigmoid(a1)
  <span class="org-variable-name">a2</span> = np.dot(z1, W2) + b2
  <span class="org-variable-name">z2</span> = sigmoid(a2)
  <span class="org-variable-name">a3</span> = np.dot(z2, W3) + b3
  <span class="org-variable-name">y</span> = identity_function(a3)

  <span class="org-keyword">return</span> y

<span class="org-variable-name">network</span> = init_network()
<span class="org-variable-name">x</span> = np.array([1.0, 0.5])
<span class="org-variable-name">y</span> = forward(network, x)
<span class="org-keyword">print</span>(y)
</pre>
</div>

<pre class="example">
[0.31682708 0.69627909]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 12: </span>ソフトマックス関数</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">a</span> = np.array([0.3, 2.9, 4.0])
<span class="org-variable-name">exp_a</span> = np.exp(a) <span class="org-comment-delimiter"># </span><span class="org-comment">&#25351;&#25968;&#38306;&#25968;</span>
<span class="org-variable-name">sum_exp_a</span> = np.<span class="org-builtin">sum</span>(exp_a) <span class="org-comment-delimiter"># </span><span class="org-comment">&#25351;&#25968;&#38306;&#25968;&#12398;&#21644;</span>
<span class="org-variable-name">y</span> = exp_a / sum_exp_a
<span class="org-keyword">print</span>(exp_a)
<span class="org-keyword">print</span>(sum_exp_a)
<span class="org-keyword">print</span>(y)

</pre>
</div>

<pre class="example">
[ 1.34985881 18.17414537 54.59815003]
74.1221542101633
[0.01821127 0.24519181 0.73659691]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 13: </span>ソフトマックス関数のオーバーフロー</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">a</span> = np.array([1010, 1000, 990])
<span class="org-variable-name">result</span> = np.exp(a) / np.<span class="org-builtin">sum</span>(np.exp(a))
<span class="org-keyword">print</span>(result)
</pre>
</div>

<pre class="example">
[nan nan nan]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 14: </span>ソフトマックス関数のオーバーフロー対策。入力信号の最大値を引く</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">a</span> = np.array([1010, 1000, 990])
<span class="org-variable-name">c</span> = np.<span class="org-builtin">max</span>(a)
<span class="org-variable-name">result</span> = np.exp(a-c) / np.<span class="org-builtin">sum</span>(np.exp(a-c))
<span class="org-keyword">print</span>(result)
</pre>
</div>

<pre class="example">
[9.99954600e-01 4.53978686e-05 2.06106005e-09]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 15: </span>ソフトマックス関数の特徴</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">def</span> <span class="org-function-name">softmax</span>(a):
    <span class="org-variable-name">c</span> = np.<span class="org-builtin">max</span>(a)
    <span class="org-variable-name">exp_a</span> = np.exp(a - c) <span class="org-comment-delimiter"># </span><span class="org-comment">&#12458;&#12540;&#12496;&#12540;&#12501;&#12525;&#12540;&#23550;&#31574;</span>
    <span class="org-variable-name">sum_exp_a</span> = np.<span class="org-builtin">sum</span>(exp_a)
    <span class="org-variable-name">y</span> = exp_a / sum_exp_a

    <span class="org-keyword">return</span> y

<span class="org-variable-name">a</span> = np.array([0.3, 2.9, 4.0])
<span class="org-variable-name">y</span> = softmax(a)
<span class="org-keyword">print</span>(y)
<span class="org-keyword">print</span>(np.<span class="org-builtin">sum</span>(y))
</pre>
</div>

<pre class="example">
[0.01821127 0.24519181 0.73659691]
1.0
</pre>

<p>
ソフトマックス関数の出力の総和は1になる。この性質のおかげでソフトマックス関数の出力を確率として解釈できる。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 16: </span>NumPy配列どうしで比較する</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">y</span> = np.array([1, 2, 1, 0])
<span class="org-variable-name">t</span> = np.array([1, 2, 0, 0])
<span class="org-keyword">print</span>(y==t)
</pre>
</div>

<pre class="example">
[ True  True False  True]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 17: </span>2乗誤差</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">def</span> <span class="org-function-name">sum_squared_error</span>(y, t):
    <span class="org-keyword">return</span> 0.5 * np.<span class="org-builtin">sum</span>((y-t)**2)

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12300;2&#12301;&#12434;&#27491;&#35299;&#12392;&#12377;&#12427;</span>
<span class="org-variable-name">t</span> = [0,0,1,0,0,0,0,0,0,0]

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12300;2&#12301;&#12398;&#30906;&#29575;&#12364;&#26368;&#12418;&#39640;&#12356;&#22580;&#21512;</span>
<span class="org-variable-name">y</span> = [0.1, 0.05, 0.6, 0.0, 0.05, 0.1, 0.0, 0.1, 0.0, 0.0]
<span class="org-keyword">print</span>(sum_squared_error(np.array(y), np.array(t)))

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12300;7&#12301;&#12398;&#30906;&#29575;&#12364;&#26368;&#12418;&#39640;&#12356;&#22580;&#21512;</span>
<span class="org-variable-name">y</span> = [0.1, 0.05, 0.1, 0.0, 0.05, 0.1, 0.0, 0.6, 0.0, 0.0]
<span class="org-keyword">print</span>(sum_squared_error(np.array(y), np.array(t)))
</pre>
</div>

<pre class="example">
0.09750000000000003
0.5975
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 18: </span>誤差エントロピー誤差</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">def</span> <span class="org-function-name">cross_entropy_error</span>(y, t):
  <span class="org-variable-name">delta</span> = 1e-7 <span class="org-comment-delimiter"># </span><span class="org-comment">&#24494;&#32048;&#12394;&#20516;&#12434;&#36861;&#21152;&#12375;&#12390;&#12510;&#12452;&#12490;&#12473;&#28961;&#38480;&#22823;&#12434;&#30330;&#29983;&#12373;&#12379;&#12394;&#12356;&#12424;&#12358;&#12395;&#12377;&#12427;</span>
  <span class="org-keyword">return</span> -np.<span class="org-builtin">sum</span>(t * np.log(y + delta))

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12300;2&#12301;&#12434;&#27491;&#35299;&#12392;&#12377;&#12427;</span>
<span class="org-variable-name">t</span> = [0,0,1,0,0,0,0,0,0,0]

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12300;2&#12301;&#12398;&#30906;&#29575;&#12364;&#26368;&#12418;&#39640;&#12356;&#22580;&#21512;</span>
<span class="org-variable-name">y</span> = [0.1, 0.05, 0.6, 0.0, 0.05, 0.1, 0.0, 0.1, 0.0, 0.0]
<span class="org-keyword">print</span>(cross_entropy_error(np.array(y), np.array(t)))

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12300;7&#12301;&#12398;&#30906;&#29575;&#12364;&#26368;&#12418;&#39640;&#12356;&#22580;&#21512;</span>
<span class="org-variable-name">y</span> = [0.1, 0.05, 0.1, 0.0, 0.05, 0.1, 0.0, 0.6, 0.0, 0.0]
<span class="org-keyword">print</span>(cross_entropy_error(np.array(y), np.array(t)))
</pre>
</div>

<pre class="example">
0.510825457099338
2.302584092994546
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 19: </span>ランダムに選び出す</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">print</span>(np.random.choice(60000, 10))
</pre>
</div>

<pre class="example">
[ 2811 41200  8006  1524 57277 54382 27135 35842 18590 13150]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 20: </span>微分の悪い実装例</label><pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">numerical_diff</span>(f, x):
  <span class="org-variable-name">h</span> = 1e-50 <span class="org-comment-delimiter"># </span><span class="org-comment">&#12372;&#12367;&#23567;&#12373;&#12356;&#20516;</span>
  <span class="org-keyword">return</span> (f(x+h) - f(x)) / h
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 21: </span>丸め誤差を試す</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">print</span>(np.float32(1e-50))
</pre>
</div>

<pre class="example">
0.0
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 22: </span>微分の改良した実装例</label><pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">numerical_diff</span>(f, x):
  <span class="org-variable-name">h</span> = 1e-4 <span class="org-comment-delimiter"># </span><span class="org-comment">&#20024;&#12417;&#35492;&#24046;&#12434;&#12373;&#12369;&#12427;</span>
  <span class="org-keyword">return</span> (f(x+h) - f(x-h)) / (2*h) <span class="org-comment-delimiter"># </span><span class="org-comment">&#20013;&#24515;&#24046;&#20998;&#12391;&#35492;&#24046;&#12434;&#28187;&#12425;&#12379;&#12427;</span>
</pre>
</div>

<pre class="example">

</pre>

<ul class="org-ul">
<li>極小な差分によって微分を求めることを数値微分という。数式の展開によって微分を求めることを解析的に微分を求めるなどという(p99)</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 23: </span>数値微分の例</label><pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">function_1</span>(x):
  <span class="org-keyword">return</span> 0.01*x**2 + 0.1*x

<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">import</span> matplotlib.pylab <span class="org-keyword">as</span> plt

<span class="org-variable-name">x</span> = np.arange(0.0, 20.0, 0.1)
<span class="org-variable-name">y</span> = function_1(x)
plt.xlabel(<span class="org-string">"x"</span>)
plt.ylabel(<span class="org-string">"f(x)"</span>)
plt.plot(x, y)
plt.show()
</pre>
</div>

<pre class="example">

</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 24: </span>2変数</label><pre class="src src-python"><span class="org-keyword">def</span> <span class="org-function-name">function_2</span>(x):
  <span class="org-keyword">return</span> x[0]**2 + x[1]**2

<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">import</span> matplotlib.pylab <span class="org-keyword">as</span> plt

<span class="org-comment-delimiter"># </span><span class="org-comment">x = np.arange(0.0, 20.0, 0.1)</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">y = function_2(x)</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">plt.xlabel("x")</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">plt.ylabel("f(x)")</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">plt.plot(x, y)</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">plt.show()</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">x&#12392;y&#12398;&#31684;&#22258;&#12434;&#35373;&#23450;</span>
<span class="org-variable-name">x</span> = np.linspace(-5, 5, 100)
<span class="org-variable-name">y</span> = np.linspace(-5, 5, 100)

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12513;&#12483;&#12471;&#12517;&#12464;&#12522;&#12483;&#12489;&#12434;&#20316;&#25104;</span>
<span class="org-variable-name">X</span>, <span class="org-variable-name">Y</span> = np.meshgrid(x, y)

<span class="org-comment-delimiter"># </span><span class="org-comment">&#38306;&#25968;&#12398;&#20516;&#12434;&#35336;&#31639;</span>
<span class="org-variable-name">Z</span> = function_2([X, Y])

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12503;&#12525;&#12483;&#12488;&#12434;&#20316;&#25104;</span>
<span class="org-variable-name">fig</span> = plt.figure()
<span class="org-variable-name">ax</span> = fig.add_subplot(111, projection=<span class="org-string">'3d'</span>)
ax.plot_surface(X, Y, Z, cmap=<span class="org-string">'viridis'</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12464;&#12521;&#12501;&#12398;&#12521;&#12505;&#12523;&#12434;&#35373;&#23450;</span>
ax.set_xlabel(<span class="org-string">'X axis'</span>)
ax.set_ylabel(<span class="org-string">'Y axis'</span>)
ax.set_zlabel(<span class="org-string">'Z axis'</span>)
ax.set_title(<span class="org-string">'3D plot of function_2'</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">&#12464;&#12521;&#12501;&#12434;&#34920;&#31034;</span>
plt.show()
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-keyword">def</span> <span class="org-function-name">function_2</span>(x):
    <span class="org-keyword">return</span> x[0]**2 + x[1]**2

<span class="org-keyword">def</span> <span class="org-function-name">numerical_gradient</span>(f, x):
    <span class="org-variable-name">h</span> = 1e-4
    <span class="org-variable-name">grad</span> = np.zeros_like(x) <span class="org-comment-delimiter"># </span><span class="org-comment">x&#12392;&#21516;&#12376;&#24418;&#29366;&#12398;&#37197;&#21015;&#12434;&#29983;&#25104;&#12377;&#12427;</span>

    <span class="org-keyword">for</span> idx <span class="org-keyword">in</span> <span class="org-builtin">range</span>(x.size):
        <span class="org-variable-name">tmp_val</span> = x[idx]
        <span class="org-variable-name">x</span>[idx] = tmp_val + h
        <span class="org-variable-name">fxh1</span> = f(x)

        <span class="org-variable-name">x</span>[idx] = tmp_val - h
        <span class="org-variable-name">fxh2</span> = f(x)

        <span class="org-variable-name">grad</span>[idx] = (fxh1 - fxh2) / (2*h)
        <span class="org-variable-name">x</span>[idx] = tmp_val <span class="org-comment-delimiter"># </span><span class="org-comment">&#20516;&#12434;&#20803;&#12395;&#25147;&#12377;</span>

    <span class="org-keyword">return</span> grad

<span class="org-keyword">print</span>(numerical_gradient(function_2, np.array([3.0, 4.0])))
<span class="org-keyword">print</span>(numerical_gradient(function_2, np.array([0.0, 2.0])))
</pre>
</div>

<pre class="example">
[6. 8.]
[0. 4.]
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 25: </span>勾配降下法</label><pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-comment-delimiter"># </span><span class="org-comment">&#24494;&#20998;</span>
<span class="org-keyword">def</span> <span class="org-function-name">numerical_gradient</span>(f, x):
    <span class="org-variable-name">h</span> = 1e-4
    <span class="org-variable-name">grad</span> = np.zeros_like(x) <span class="org-comment-delimiter"># </span><span class="org-comment">x&#12392;&#21516;&#12376;&#24418;&#29366;&#12398;&#37197;&#21015;&#12434;&#29983;&#25104;&#12377;&#12427;</span>

    <span class="org-keyword">for</span> idx <span class="org-keyword">in</span> <span class="org-builtin">range</span>(x.size):
        <span class="org-variable-name">tmp_val</span> = x[idx]
        <span class="org-variable-name">x</span>[idx] = tmp_val + h
        <span class="org-variable-name">fxh1</span> = f(x)

        <span class="org-variable-name">x</span>[idx] = tmp_val - h
        <span class="org-variable-name">fxh2</span> = f(x)

        <span class="org-variable-name">grad</span>[idx] = (fxh1 - fxh2) / (2*h)
        <span class="org-variable-name">x</span>[idx] = tmp_val <span class="org-comment-delimiter"># </span><span class="org-comment">&#20516;&#12434;&#20803;&#12395;&#25147;&#12377;</span>

    <span class="org-keyword">return</span> grad

<span class="org-comment-delimiter"># </span><span class="org-comment">&#21246;&#37197;&#38477;&#19979;</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">lr -&gt; learning rate</span>
<span class="org-keyword">def</span> <span class="org-function-name">gradient_descent</span>(f, init_x, lr=0.01, step_num=100):
  <span class="org-variable-name">x</span> = init_x

  <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(step_num):
    <span class="org-variable-name">grad</span> = numerical_gradient(f, x)
    <span class="org-variable-name">x</span> -= lr * grad

  <span class="org-keyword">return</span> x

<span class="org-keyword">def</span> <span class="org-function-name">function_2</span>(x):
  <span class="org-keyword">return</span> x[0]**2 + x[1]**2

<span class="org-variable-name">init_x</span> = np.array([-3.0, 4.0])
<span class="org-keyword">print</span>(gradient_descent(function_2, init_x=init_x, lr=0.1, step_num=100))
</pre>
</div>

<pre class="example">
[-6.11110793e-10  8.14814391e-10]
</pre>

<ul class="org-ul">
<li>損失関数を重みで微分することで、各重みが損失関数にどの程度影響を与えるかを知ることができる</li>
<li>勾配(微分の結果)は、損失関数の値がもっとも急速に変化する方向とその大きさを示す。重みをどの方向にどれだけ調整すれば損失関数を最小化できるかを示す</li>
</ul>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> sys, os
sys.path.append(os.environ[<span class="org-string">'HOME'</span>] + <span class="org-string">"/Project/zerodeep1"</span>)
<span class="org-keyword">from</span> ch04.gradient_simpleset <span class="org-keyword">import</span> simpleNet

<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">net</span> = simpleNet()
<span class="org-keyword">print</span>(net.W)

<span class="org-variable-name">x</span> = np.array([0.6, 0.9])
<span class="org-variable-name">p</span> = net.predict(x)
<span class="org-keyword">print</span>(p)

<span class="org-keyword">print</span>(np.argmax(p)) <span class="org-comment-delimiter"># </span><span class="org-comment">&#26368;&#22823;&#20516;&#12398;&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;</span>

<span class="org-variable-name">t</span> = np.array([0, 0, 1]) <span class="org-comment-delimiter"># </span><span class="org-comment">&#27491;&#35299;&#12521;&#12505;&#12523;</span>
<span class="org-keyword">print</span>(net.loss(x, t))
</pre>
</div>

<pre class="example">
[[-0.49595624  0.76780514 -0.77374279]
 [ 0.30493713  0.28693231  1.38213332]]
[-0.02313033  0.71892216  0.77967431]
2
0.8709277794567005
</pre>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> sys, os
sys.path.append(os.environ[<span class="org-string">'HOME'</span>] + <span class="org-string">"/Project/zerodeep1"</span>)
<span class="org-keyword">from</span> ch04.gradient_simpleset <span class="org-keyword">import</span> simpleNet
<span class="org-keyword">from</span> ch04.gradient <span class="org-keyword">import</span> numerical_gradient

<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np

<span class="org-variable-name">x</span> = np.array([0.6, 0.9])
<span class="org-variable-name">t</span> = np.array([0, 0, 1])

<span class="org-variable-name">net</span> = simpleNet()

<span class="org-variable-name">f</span> = <span class="org-keyword">lambda</span> w: net.loss(x, t)
<span class="org-variable-name">dW</span> = numerical_gradient(f, net.W)
<span class="org-keyword">print</span>(dW)
</pre>
</div>

<pre class="example">
[[ 0.52613449  0.03084159 -0.55697608]
 [ 0.78920174  0.04626239 -0.83546413]]
</pre>
</div>
</div>

<div id="outline-container-org723087a" class="outline-2">
<h2 id="org723087a"><a href="#org723087a">関連</a></h2>
<div class="outline-text-2" id="text-org723087a">
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"/>
</div>
</body>
</html>
