:PROPERTIES:
:ID:       7a81eb7c-8e2b-400a-b01a-8fa597ea527a
:header-args+: :wrap
:END:
#+title: Linux
* 概要
GNU LinuxはオープンソースのOS。
もっとも成功した[[id:bb71747d-8599-4aee-b747-13cb44c05773][OSS]]プロジェクトの1つで、世界中の開発者によって開発が進められている。
* Memo
** tzdataとは
tzdataは、タイムゾーン（時刻帯）のデータベースであり、主にオペレーティングシステムやプログラミング言語で使用される。タイムゾーンデータは、世界中の異なる地域と時間帯の間の変換や日付・時刻の計算を可能にする。

tzdataには、地域ごとの時差や夏時間の情報が含まれている。このデータベースは、世界各地の政府機関や国際的な規格に基づいて維持され、定期的に更新される。タイムゾーンデータは、UTC(協定世界時)を基準として、地域ごとの時差を正確に表現する。

プログラミング言語やオペレーティングシステムでは、tzdataを使用して、タイムゾーンに関連する情報を取得し、日付や時刻の変換、タイムゾーンの切り替え、夏時間…を処理する。一般的に、タイムゾーンデータはデータベースファイルやライブラリとして提供され、プログラム内で利用される。

タイムゾーンデータは、日々の時間管理や国際的な日付やイベントの処理において重要な役割を果たす。正確な時刻の取得や表示、イベントのスケジュール管理、タイムゾーンに関連する問題の処理において、tzdataは欠かせない要素となっている。
** AF_VSOCK(Virtual Socket Family)とは
AF_VSOCKは、Linuxカーネルで利用されるソケットファミリーの1つ。AF_VSOCKは、仮想マシンやコンテナなどの異なるホスト間での通信を可能にするため設計されている。ホストと仮想マシンまたはコンテナ間での高速で効率的な通信ができる。ソケットを介して異なる仮想マシン/コンテナ間でデータを送受信できる。
** プロセスとスレッドの違い
- [[https://webpia.jp/thread_process/][プロセスとスレッドの違いとは？超わかりやすく解説！【図解とプログラム付き】 | Webpia]]

構造。プロセス・スレッドというが、別階層の話。

- OS
  - プロセス
    - スレッド

- プロセス :: 実行中のプログラム。OSによってプロセスは管理される。プロセス間では別のメモリ空間が割り当てられるので影響を及ぼすことはない。プロセス間でメモリを共有しない
- スレッド :: プロセスによってスレッドは管理される。プロセス内の同じメモリ領域を共有する。スレッドは、スレッド同士で同じメモリ領域を使う。マルチスレッドにすることで並列処理ができるのがメリット
  - プログラムから見たスレッドは、メモリにロードされたプログラムの現在の実行状態を持つ仮想CPU
  - 仮想CPUのそれぞれに、スタックメモリが割り当てられている
  - OSやCPUから見たスレッドは、時間が凍結されたプログラムの実行状態
  - OSの仕事は、凍結状態のプログラムの実行状態を復元して、各スレッドを順番に短時間ずつ処理を再開させること
  - 複数のプログラムは、時間分割されてCPUコアにマッピングされて実行される

- シングルスレッドのプロセス: 1つしかスレッドを持たない
- マルチスレッドのプロセス: 複数スレッドを持つプロセス

** 特殊なディレクトリ
慣例的に使われる特別なディレクトリがある。

たとえば ~/etc/skel/~ は、ユーザが作成されたときのホームディレクトリのベースになる。前もってここに配置しておくと、ユーザが作られたあとホームディレクトリにコピーされ、ユーザが扱える。

~/etc/default/useradd~ に書いてあり、useraddを経由した変更もできる。

** インストールディスク作成

Linux環境でブータブルUSBを作成するとき、よくわからない要因によって失敗することが何度かあった。たいていはブートできないというもの。

- [[https://help.ubuntu.com/community/LiveCDCustomization][LiveCDCustomization - Community Help Wiki]]
  - ライブCDのカスタマイズ方法の詳しいドキュメント。GitHub Actionsでも実行できる

既存のベースとなるisoを持ってくる。isoを展開する。展開したシステムディレクトリをマウントする。この時点で、システムはiso内にあるものが使われ、変更もiso内に反映される。

- unetbootinを使う
  - [[https://unetbootin.github.io/linux_download.html][UNetbootin - Linux Downloads]]
- 焼く前に、USBドライブをext4でフォーマットする。それ以外だとbootに失敗することがある
- 仮想マシンで素早くテストできる
  - ~sudo apt install qemu-kvm~
  - ~qemu-system-x86_64 -boot d -cdrom ubuntu.iso -enable-kvm -m 4096~

** lsのソースコード
#+caption: getoptで引数を取り出し、switchで処理する
#+begin_src git-permalink
https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/bin/ls/ls.c#L154-L169
#+end_src

#+RESULTS:
#+begin_results
	while ((ch = getopt(argc, argv, "1AaBbCcdFfghikLlMmnOoPpqRrSsTtuWwXx"))
	    != -1) {
		switch (ch) {
		/*
		 * The -1, -C, -l, -m and -x options all override each other so
		 * shell aliasing works correctly.
		 */
		case '1':
			f_singlecol = 1;
			f_column = f_columnacross = f_longform = f_stream = 0;
			break;
		case 'C':
			f_column = 1;
			f_columnacross = f_longform = f_singlecol = f_stream =
			    0;
			break;
#+end_results

** cdのソースコード
#+begin_src git-permalink
https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/bin/sh/cd.c#L52-L54
#+end_src

#+RESULTS:
#+begin_results
/*
 * The cd and pwd commands.
 */
#+end_results

** echoのソースコード
#+caption: netBSDのechoのソースコード。本質的にprintf
#+begin_src git-permalink
https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/bin/echo/echo.c#L1
#+end_src

#+RESULTS:
#+begin_results
/* $NetBSD: echo.c,v 1.23 2021/11/16 21:38:29 rillig Exp $	*/
#+end_results

#+caption: nflagには0か1が入る
#+begin_src git-permalink
https://github.com/kd-collective/NetBSD/blob/89341ae2e1875e7f91cefa9b1dcc0e4549edcde0/bin/echo/echo.c#L60
#+end_src

#+RESULTS:
#+begin_results
	nflag = *++argv != NULL && strcmp(*argv, "-n") == 0;
#+end_results

- getopt関数を使っていない
** ctrl+shiftが機能しない
インプットメソッドによって、入力方法の変更ショートカットが奪われる。
https://superuser.com/questions/358749/how-to-disable-ctrlshiftu

fcitxを使っている場合、 ~fcitx-configtool~ で設定できる。
全体の設定 → 入力メソッドの切り替えで、別のキーボードの組み合わせを選択する。
** ディスプレイマネージャーを再起動
壊れたときにシステム再起動よりはやく復帰できる。
#+begin_src shell
  systemctl restart display-manager
#+end_src
** linux mintでsnapをインストールする
#+begin_src shell
  sudo rm /etc/apt/preferences.d/nosnap.pref
#+end_src
** bluetoothが動かないとき
新しくクリーンインストールしたところ、Bluetooth接続ができなかった。
インストール前はできていたから、ハードウェアに問題はない。

前はデフォルトでできてたはずだが、bluetooth周辺ライブラリをインストールしてサービスを再起動する。
どれが効いたのかはさだかではないが、接続できるようになった。

#+begin_src shell
  sudo apt-get install bluetooth bluez bluez-tools rfkill blueman

  # 強制的に全てのブロックを解除
  sudo rfkill unblock all
  # Bluetoothを再起動
  sudo systemctl restart bluetooth.service
#+end_src

- [[https://blog.hanhans.net/2019/03/18/ubuntu-enable-bluetooth/][強制的に全てのブロックを解除 1 $ sudo rfkill unblock all Bluetoothを再起動 1 $ sudo systemctl restart bluetooth.service]]
** caps_lockをコマンドで切り替える
Caps LockをControlに入れ替えていると、xmodmapをいじったときに大文字のまま元に戻せなくなることがある。
代替のキーはないので困る。コマンドでできる。
#+begin_src shell
sudo apt-get install xdotool
xdotool key Caps_Lock
#+end_src
* Tasks
** TODO [[https://tatsu-zine.com/books/linux-bootprocess][新装改訂版 Linuxのブートプロセスをみる【委託】 - 達人出版会]]
ブートプロセスを追う本。
** TODO [[https://tatsu-zine.com/books/naruhounix][なるほどUnixプロセス ― Rubyで学ぶUnixの基礎 - 達人出版会]]
プロセスの解説。
** WIP [[https://www.seshop.com/product/detail/20694][詳解UNIXプログラミング［第3版］【PDF版】 ｜ SEshop｜ 翔泳社の本・電子書籍通販サイト]] :Read:
:PROPERTIES:
:Effort:   20:00
:END:
:LOGBOOK:
CLOCK: [2023-06-28 Wed 00:53]--[2023-06-28 Wed 01:18] =>  0:25
CLOCK: [2023-06-19 Mon 00:50]--[2023-06-19 Mon 01:15] =>  0:25
CLOCK: [2023-06-18 Sun 22:47]--[2023-06-18 Sun 23:12] =>  0:25
:END:

- 29, 32

UNIXプログラミングの解説本。

- エラーが発生するとほとんどのシステム関数は-1を返す

** TODO [[https://qiita.com/ueokande/items/c75de7c9df2bcceda7a9][シェルとファイルデスクリプタのお話 - Qiita]]
ファイルディスクリプタをシェルで扱う。
** TODO [[https://milestone-of-se.nesuke.com/sv-basic/linux-basic/fd-stdinout-pipe-redirect/][【図解】file descriptorと標準入力/出力とパイプ,リダイレクト | SEの道標]]
ファイルディスクリプタ。
** TODO [[https://book.mynavi.jp/ec/products/detail/id=121220][ゼロからのOS自作入門 | マイナビブックス]]
:LOGBOOK:
CLOCK: [2022-11-19 Sat 09:48]--[2022-11-19 Sat 10:13] =>  0:25
:END:
ゼロからOSを自作する本。
** TODO [[https://www.shuwasystem.co.jp/book/9784798044781.html][ハロー“Hello, World” OSと標準ライブラリのシゴトとしくみ]]
printを実行するとき何が起こっているかの解説。
** TODO [[https://linuxjf.osdn.jp/JFdocs/The-Linux-Kernel.html#toc14][The Linux Kernel]]
:LOGBOOK:
CLOCK: [2022-05-15 Sun 18:20]--[2022-05-15 Sun 18:45] =>  0:25
:END:
Linuxカーネルの解説。
** TODO [[https://0xax.gitbooks.io/linux-insides/content/][Introduction · Linux Inside]]
Linuxカーネルの解説。
** TODO [[https://www.oreilly.co.jp/books/9784873113623/][O'Reilly Japan - Linuxシステムプログラミング]]
システムプログラミングの本。
** TODO [[https://www.oreilly.co.jp/books/9784873115856/][O'Reilly Japan - Linuxプログラミングインタフェース]]
Linuxのリファレンス。
** TODO [[https://www.oreilly.co.jp/books/9784873113135/][O'Reilly Japan - 詳解 Linuxカーネル 第3版]]
:LOGBOOK:
CLOCK: [2022-06-01 Wed 00:42]--[2022-06-01 Wed 01:07] =>  0:25
:END:
- 15
カーネルのソースコードを読む本。
* Reference
** [[https://qiita.com/stc1988/items/41d9da92ea02fc3d15a3][SquashFSをマウントするまで - Qiita]]
システムをファイルに圧縮するとき使う。
** [[https://www.express.nec.co.jp/linux/distributions/knowledge/system/useradd.html][新規ユーザ作成時のデフォルト値の設定]]
ユーザの設定方法。ここでデフォルトディレクトリに ~/etc/skel~ 指定している。
** [[https://tech.unifa-e.com/entry/2019/05/23/172424][sudo実行時のカレントディレクトリや環境変数などの挙動について - ユニファ開発者ブログ]]
sudoの解説。
** [[https://linuxjm.osdn.jp/html/sudo/man8/sudo.8.html][Man page of SUDO]]
sudoの解説。特にプロセスモデルに関する詳しい解説。
** [[https://gihyo.jp/assets/files/event/2008/24svr/report/2-24svr-TechMTG-ito.pdf][Linuxカーネルの読み方]]
Linuxカーネルのソースコードを読むコツと参考文献がある。
** [[https://ja.wikipedia.org/wiki/Linux][Linux - Wikipedia]]
** [[https://www.geekpage.jp/blog/?id=2007/3/1][UNIX哲学の基本原則:Geekなぺーじ]]
UNIX哲学の一覧。
* Archives
