<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2025-06-14 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KDOC 252: 『月刊ラムダノート 4-3-9-2024』</title>
<meta name="author" content="root" />
<meta name="generator" content="Org Mode" />
<link rel='shortcut icon' type='image/x-icon' href='https://kijimad.github.io/roam/favicon.ico' /><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css' media='print' onload='this.media="all"' /><link rel='stylesheet' href='https://kijimad.github.io/roam/css/site.css' /><link rel='stylesheet' href='https://kijimad.github.io/roam/css/code.css' /><link rel='preconnect' href='https://fonts.googleapis.com'><link rel='preconnect' href='https://fonts.gstatic.com' crossorigin><link href='https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP&display=swap' rel='stylesheet'>
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content" class="content">
<h1 class="title">KDOC 252: 『月刊ラムダノート 4-3-9-2024』</h1>
<div id="outline-container-org1cfab16" class="outline-2">
<h2 id="org1cfab16"><a href="#org1cfab16">この文書のステータス</a></h2>
<div class="outline-text-2" id="text-org1cfab16">
<ul class="org-ul">
<li>作成
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-11-01 貴島</li>
</ul></li>
<li>レビュー
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-11-04 貴島</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org5efd1df" class="outline-2">
<h2 id="org5efd1df"><a href="#org5efd1df">概要</a></h2>
<div class="outline-text-2" id="text-org5efd1df">
<p>
<a href="https://www.lambdanote.com/collections/frontpage/products/n-vol-4-no-3-2024-ebook">n月刊ラムダノート Vol.4, No.3(2024)</a>は技術解説情報誌。以下の章で構成される。
</p>

<ol class="org-ol">
<li>TypeScriptではじめる型システム（遠藤侑介）</li>
<li>型を活用した安全なアプリケーション開発（佐藤有斗）</li>
<li>「インターネットのカタチ」のその後（小川晃通）</li>
</ol>
</div>
</div>
<div id="outline-container-org5192261" class="outline-2">
<h2 id="org5192261"><a href="#org5192261">メモ</a></h2>
<div class="outline-text-2" id="text-org5192261">
<ul class="org-ul">
<li>たとえば処理系ではプログラムを実行するたびに「値がnullでないか」をチェックする。こうしたチェックには、計算機性能や用途次第では無視できないほどのオーバーヘッドがかかる。そこで歴史的に、動作保証しようとしたら実行時オーバーヘッドがかかってしまうような動作は「未定義」であるとし、その対処を言語の責任ではなくプログラマの責任としたCやC++といったプログラミング言語が、特に実行速度が求められるプログラムでは使われてきた。しかし未定義動作は、その回避に対して責任があるプログラマにとっては不便であったり間違いの原因になったりする。このように未定義動作に陥る問題を解決する方法のひとつが型システムである。未定義動作に陥る可能性のあるプログラムを実行前に型検査器で判定し、OKとされたプログラムは未定義動作にならない、ということが保証できる(p5)</li>
<li><a href="20210509100112-javascript.html#ID-a6980e15-ecee-466e-9ea7-2c0210243c0d">JavaScript</a>のプログラムは未定義動作に陥ることがない。なので<a href="20210831232330-typescript.html#ID-ad1527ee-63b3-4a9b-a553-10899f57c234">TypeScript</a>の型システムは型安全性を厳密に保証する必要がない(p5)</li>
<li>&ldquo;argument&rdquo; と &ldquo;parameter&rdquo; を使い分けることもある。&ldquo;argument&rdquo; を実引数、 &ldquo;parameter&rdquo; を仮引数として使い分けたりする。言語やコミュニティによって異なる(p19)</li>
<li>型の等価判定をするための関数と、変数がどういう型を持っているかの情報を保持する仕組みを実装する(p22)</li>
<li>TAPLの11.3節のタイトルにある「派生」は、型システムにおいて逐次実行や変数参照が「関数という基本的な操作から派生的に得られるもの」ということを意味している、という(p35)</li>
</ul>

<p>
以下のTypeScriptのコードは型エラーにならないが、実行時に失敗する。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>初期化前のxを参照する</label><pre class="src src-typescript">const f = () =&gt; x;
f(); // 初期化前の x を参照する
const x = 1;
</pre>
</div>

<ul class="org-ul">
<li>ビジネスロジックを代数的データ型により表現するという考え方や、状態遷移を全域関数として記述することで異常な処理を防ぐ手法がある、という(p39)</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>このようにステータスごとに型を分けると実装ミスを型システムで防げる</label><pre class="src src-scala">class ConfirmedOrder(
  val orderId: OrderId,
  val customerId: CustomerId,
  val shippingAddress: Address,
  val lines: List[OrderLine],
  val confirmedAt: LocalDateTime,
)

class CancelledOrder(
  val orderId: OrderId,
  val customerId: CustomerId,
  val shippingAddress: Address,
  val lines: List[OrderLine],
  val confirmedAt: LocalDateTime,
  val cancelledAt: LocalDateTime,
  val cancelReason: String,
)
</pre>
</div>

<ul class="org-ul">
<li>↑その代わりにorderとして共通の処理が書きにくくなるので、各ステータスのクラスをサブクラスとする(p46)</li>
<li>直積型と直和型を組み合わせる「代数的データ型」</li>
<li>直和型はinterfaceとかtraitなど、異なる型を同じように扱うもの
<ul class="org-ul">
<li>Order は、 ConfirmedOrder + CancelOrder + ShippingOrder</li>
</ul></li>
<li>直積型は各フィールド
<ul class="org-ul">
<li>CanceledOrder は、OrderID x DateTime(キャンセル日時) x String(キャンセル日時)</li>
</ul></li>
<li>状態遷移をそれぞれの型にメソッドとして実装すれば、そもそもメソッドが定義されていない型に対して処理を呼び出すことはできなくなる(p56)</li>
<li>全域関数(total function)は、「すべての入力値に対して必ず出力値が1つ存在する関数」である。いっぽう、一部の入力値に対して出力値が存在しない関数のことを部分関数という(p56)</li>
</ul>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>0以外の値の型を作る</label><pre class="src src-scala">class NonZeroInt(val value: Int) {
  require(value != 0, "0 以外の整数を入力してください ")
}

def divideTwelveBy(n: NonZeroInt): Int = 12 / n.value
</pre>
</div>

<ul class="org-ul">
<li>divideTwelveByは、NonZeroInt型に対して全域関数である。いっぽう、nの型をintにすると0が入る可能性があるので部分関数となっている(p57)</li>
<li>開発において何かしら例外を投げる関数を書く必要が生じたときは、その仕様を型で表現することにより全域関数として定義できないかを意識するとよい、という(p59)</li>
<li>コンストラクタの可視性をコントロールすることで、「あるインスタンスは特定の箇所からのみ作成可能」という状態を作り出せる。不正な状態のインスタンスを作るのを防げる(p63)</li>
<li>リレーショナルDBなど外部システムは、アプリケーション上の型より「広い」型を持つ。そのため外部から内部の変換(DBからは読み込み)では失敗することがある。いっぽう内部から外部の変換(DBからは書き込み)は「狭い」型からの変換なので失敗することがないケースが多い(p72)</li>
<li>本稿の執筆に際し、「2011年当時はどうだったか？」を確認するためにさまざまな情報源を参照した、という。昔書いた原稿や当時の記事などを読み返すうちに、非常に多くの記事がインターネット上から消えてしまっている事実をあらためて思い知らされた、という(p92)</li>
</ul>
</div>
</div>
<div id="outline-container-org35c491a" class="outline-2">
<h2 id="org35c491a"><a href="#org35c491a">関連</a></h2>
<div class="outline-text-2" id="text-org35c491a">
<p>
なし。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer>
</div>
</body>
</html>
