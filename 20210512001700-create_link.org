#+title: create-link
#+author: kijimad

* Emacsãƒ‘ãƒƒã‚±ãƒ¼ã‚¸(#2)ã‚’ä½œã‚Šã¾ã—ãŸã€‚
[[https://github.com/kijimaD/create-link][GitHub - kijimaD/create-link: Formatted link generator package for Emacs.]]
* ã‚„ã£ãŸã“ã¨
** Chromeæ‹¡å¼µCreateLinkã‚’Emacsã«ç§»æ¤ã—ãŸ
~CreateLink~ ã¨ã„ã†Chromeæ‹¡å¼µãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã®Emacsç‰ˆã‚’ä½œæˆã—ã¦ã¿ã¾ã—ãŸã€‚

** å…ƒã«ãªã£ãŸCreateLinkã®èª¬æ˜ğŸ”—
ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®åå‰ã®ã¤ã„ãŸãƒªãƒ³ã‚¯ã‚’å–å¾—ã™ã‚‹æ‹¡å¼µã§ã™ã€‚GitHubã¨ã‹Slackã«è²¼ã‚Šä»˜ã‘ã‚‹ã¨ãã«ä¾¿åˆ©ãªã‚„ã¤ã§ã™ã€‚

- CreateLinkã®ãƒªãƒ³ã‚¯(Chrome ã‚¦ã‚§ãƒ–ã‚¹ãƒˆã‚¢)
https://chrome.google.com/webstore/detail/create-link/gcmghdmnkfdbncmnmlkkglmnnhagajbm?hl=ja

- ä¾‹: Markdownãƒªãƒ³ã‚¯ã ã¨ã€
https://www.google.com -> [Google](https://www.google.com/) ã¿ãŸã„ãªã€‚

(ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ¢)
** ä½œæˆã—ãŸcreate-linkã®ãƒ‡ãƒ¢
- å„ç¨®ãƒ–ãƒ©ã‚¦ã‚¶ eww, w3m
- å„ç¨®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ HTML(default), LaTeX, Markdown, MediaWiki, Org-mode
- ãƒ–ãƒ©ã‚¦ã‚¶ä»¥å¤–ã®ã¨ãã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹

ã«å¯¾å¿œã—ã¦ã¾ã™ã€‚

(å®Ÿè¡Œãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ“ä½œã®ãƒ‡ãƒ¢)
* ã‚³ãƒ¼ãƒ‰
ä½œã£ã¦ã™ãå…¬å¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é›†ã«PRã‚’é€ã‚Šã¾ã—ãŸ(ã¾ã è¿”ä¿¡æ¥ãªã„)ã€‚
ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®éƒ¨åˆ†ã‚’é™¤ãã¨ã€90è¡Œãã‚‰ã„ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚

åŠåˆ†ãã‚‰ã„ã¯ãƒ¦ãƒ¼ã‚¶è¨­å®šã®ãŸã‚ã®æ±ºã¾ã‚Šãã£ãŸè¨˜è¿°ã®ãŸã‚ã€å®Ÿéš›ã¯40è¡Œã»ã©ã€‚

#+begin_src emacs-lisp
;;; Code:

(require 'eww)
(require 'w3m)

(defgroup create-link nil
  "Generate a formatted current page link."
  :group 'convenience
  :prefix "create-link-")

(defcustom create-link-default-format 'html
  "Default link format."
  :group 'create-link
  :type '(choice (const :tag "html" html)
                 (const :tag "markdown" markdown)
                 (other :tag "org" org)
                 (other :tag "media-wiki" media-wiki)
		 (other :tag "latex" latex)))

;; Format keywords:
;; %url% - http://www.google.com/
;; %title% - Google
(defcustom create-link-format-html "<a href='%url%'>%title%</a>"
  "HTML link format."
  :group 'create-link
  :type 'string)

(defcustom create-link-format-markdown "[%title%](%url%)"
  "Markdown link format."
  :group 'create-link
  :type 'string)

(defcustom create-link-format-org "[[%url%][%title%]]"
  "Org-mode link format."
  :group 'create-link
  :type 'string)

(defcustom create-link-format-media-wiki "[%url% %title%]"
  "Media Wiki link format."
  :group 'create-link
  :type 'string)

(defcustom create-link-format-latex "\\href{%url%}{%title%}"
  "Latex link format."
  :group 'create-link
  :type 'string)

(defun create-link-raw-format ()
  "Choose a format type by the custom variable."
  (pcase create-link-default-format
    (`html
     create-link-format-html)
    (`markdown
     create-link-format-markdown)
    (`org
     create-link-format-org)
    (`media-wiki
     create-link-format-media-wiki)
    (`latex
     create-link-format-latex)))

(defun create-link-replace-dictionary ()
  "Convert format keyword to corresponding one."
  `(("%url%" . ,(cdr (assoc 'url (create-link-get-information))))
    ("%title%" . ,(cdr (assoc 'title (create-link-get-information))))))

(defun create-link-make-format ()
  "Fill format keywords."
  (seq-reduce
   (lambda (string regexp-replacement-pair)
     (replace-regexp-in-string
      (car regexp-replacement-pair)
      (cdr regexp-replacement-pair)
      string))
   (create-link-replace-dictionary)
   (create-link-raw-format))) ;; <a href='%url%'>%title%</a> ã¨ã‹ã€‚ãƒ«ãƒ¼ãƒ—ã®initial valueã€‚

;; <a href='%url%'>%title%</a>
;; <a href='https://...'>%title%</a> å‰ã®å€¤ã‚’ä¿æŒ
;; <a href='https://...'>Google</a> ã•ã‚‰ã«ç½®æ›

#+begin_comment
;; ã“ã“ã‚’ç¶ºéº—ã«æ›¸ãã®ãŒä¸€ç•ªã‚€ãšã‹ã—ã‹ã£ãŸã€‚...è¤‡æ•°ã®æ–‡å­—åˆ—ç½®æ›
;; ä¸€ã¤ã®ç½®æ›(replace-regexp-in-string)ã¯é–¢æ•°ãŒã‚ã‚‹ãŒã€è¤‡æ•°æŒ‡å®šã¯ã§ããªã„ã€‚

;; (seq-reduce)ã®ç¬¬ä¸€å¼•æ•°ã¯ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«ç›¸å½“ã™ã‚‹ã¨ã“ã‚ã€‚ãƒ«ãƒ¼ãƒ—ä¸€å›ã§ä½•ã‚’ã™ã‚‹ã‹ã€‚
;; stringã¯raw-format(<a href='%url%'>%title%</a>ãªã©)ã‚’å—ã‘å–ã‚Šã€regexp-replacement-pairã¯replace-dictionaryã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ†ãŒå…¥ã‚‹ã€‚ãƒ–ãƒ­ãƒƒã‚¯å¼•æ•°ã€‚
#+end_comment

(defun create-link-get-information ()
  "Get keyword information on your browser."
  (cond ((string-match-p "eww" (buffer-name))
         `((title . ,(plist-get eww-data :title))
           (url . ,(plist-get eww-data :url))))
        ((string-match-p "w3m" (buffer-name))
         `((title . ,w3m-current-title)
           (url . ,w3m-current-url)))
        ;; otherwise, create-link to the file-buffer
        (t
         `((title . ,(buffer-name))
           (url . ,(buffer-file-name))))))

;; ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
;;;###autoload
(defun create-link ()
  "Create formatted link."
  (interactive)
  (message "Copied! %s" (create-link-make-format))
  (kill-new (create-link-make-format)))

(provide 'create-link)

;;; create-link.el ends here
#+end_src

* çŸ¥è¦‹
** çŸ­ãã¦ã‚‚OK
ã‚³ãƒ¼ãƒ‰ã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ã®å‚è€ƒã«ã™ã‚‹ãŸã‚ä½¿ã£ã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚³ãƒ¼ãƒ‰ã‚’çœºã‚ã¦ã„ã¦ã€ã“ã†ã„ã†çŸ­ã„ã‚‚ã®ã§ã‚‚å¤šãã®äººã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã‘ã£ã“ã†ã‚ã‚‹ã“ã¨ã«æ°—ã¥ãã¾ã—ãŸã€‚

ã“ã‚Œã‚‰ã¯ã‘ã£ã“ã†ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚‚ã®ã€‚

[[/home/kijima/.emacs.d/.cask/27.1/elpa/add-node-modules-path-20210305.312/add-node-modules-path.el][add-node-modules-path.el]] - nodeç’°å¢ƒã®èª­ã¿è¾¼ã¿ 86è¡Œ
[[/home/kijima/.emacs.d/.cask/27.1/elpa/org-bullets-20200317.1740/org-bullets.el][org-bullets.el]] - ãƒªã‚¹ãƒˆã‚’ã„ã„æ„Ÿã˜ã«è¡¨ç¤ºã™ã‚‹ 109è¡Œ
[[/home/kijima/.emacs.d/.cask/27.1/elpa/define-word-20210103.1812/define-word.el][define-word.el]] - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è¾æ›¸ 132è¡Œ
[[/home/kijima/.emacs.d/.cask/27.1/elpa/rubocop-20210309.1241/rubocop.el][rubocop.el]] - rubocopã‚’ã„ã„æ„Ÿã˜ã« 267è¡Œ

- é‡è¦ãªã®ã¯ä¸€ã¤ã®ã“ã¨ã‚’ã†ã¾ãã‚„ã‚‹ã“ã¨ã€‚

** ä»–ã®äººã«ä½¿ã£ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã†ã‚Œã—ã„
ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é›†PRã¯å¯©æŸ»ä¸­ã§ã™ãŒã€ãƒãƒ¼ã‚¸å‰ã«ä½¿ã£ã¦ãã‚ŒãŸäººãŒã„ã¦ã€PRãŒæ¥ã¾ã—ãŸã€‚
è¤’ã‚ã¦ãã‚Œã¦ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ä¸ŠãŒã‚‹ã€‚
https://github.com/kijimaD/create-link/pull/7

#+begin_quote
I like this package, is simple and useful.
#+end_quote

å¯©æŸ»ã«ã‚€ã‘ã¦ã‚„ã£ãŸã“ã¨â†“

- ã‚ã‹ã‚Šã‚„ã™ã„ã‚³ãƒ³ã‚»ãƒ—ãƒˆã€‚
- ç©ºæ°—ã‚’èª­ã‚“ã å‹•ä½œã‚’ã™ã‚‹ã€é™ã‚‰ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹(create-link)ã¨ã„ã†é–¢æ•°1ã¤ã§ã€è¤‡æ•°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã«å¯¾å¿œã§ãã‚‹ã€‚
- ã¡ã‚ƒã‚“ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”¨æ„ã—ãŸ [[https://github.com/kijimaD/create-link][kijimaD/create-link]]
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”¨æ„ã—ãŸã€‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ç¨®é¡ã‚„ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å¢—ã‚„ã™ã®ã¯ã€ã¨ã¦ã‚‚ç°¡å˜ã§ã™ã€‚


* ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒªãƒ³ã‚¯ã‚’å–å¾—ã™ã‚‹ã ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ¼ãƒ‰ã§ã¯ã‚ã‚Šã¾ã™ãŒã€æ‹¡å¼µã¯ã„ã‚ã„ã‚è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

** å…¥å‡ºåŠ›ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¢—ã‚„ã™
- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå½¢å¼å¢—åŠ  HTML,LaTeX,Markdown,MediaWiki,Org-mode
- ãƒ¦ãƒ¼ã‚¶å®šç¾©ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ â€¦ chromeã®æ‹¡å¼µã®æ–¹ã«ã¯ã‚ã‚‹
- ~Magit(Gitã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)~ ã®å ´åˆã€‚(ã™ã§ã«GitHubãƒªãƒ³ã‚¯ã®ç”Ÿæˆã¯ã‚ã‚‹) ~git-link~ ã“ã‚Œã®æ•´å½¢ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã¿ãŸã„ãª
- PDF(ãƒšãƒ¼ã‚¸ã‚’å–ã‚‹ã“ã¨ã¯ã§ããã†ã€‚ãƒªãƒ³ã‚¯ã§ãƒšãƒ¼ã‚¸ç•ªå·ã‚’è¡¨ç¾ã§ãã‚‹ã‹ï¼Ÿ)
- ã‚·ã‚§ãƒ«ã ã£ãŸã‚‰ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–ã‚‹
- Gitãƒªãƒã‚¸ãƒˆãƒªã®ã¨ãã¯ã€ç›¸å¯¾ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³

** ã‚³ãƒ³ãƒ†ã‚¯ã‚¹ãƒˆã«ã‚ˆã‚‹å‹•ä½œã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¢—ã‚„ã™
- æ˜ç¤ºã—ã¦å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’é¸ã¹ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ 

- ãƒ†ã‚­ã‚¹ãƒˆé¸æŠä¸­ã ã¨ã€ã‚¿ã‚¤ãƒˆãƒ«ã«é¸æŠã—ãŸã¨ã“ã‚ã‚’å…¥ã‚Œã‚‹
or
- é¸æŠURLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€Titleã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã€‚ãƒªãƒ³ã‚¯ã‚’å®Œæˆã•ã›ã‚‹

** ãƒ¦ãƒ¼ã‚¶ã®æ‹¡å¼µæ€§ã‚’å¢—ã‚„ã™
- ãƒ•ãƒƒã‚¯ã‚’è¿½åŠ â€¦ãŸã¨ãˆã°ãƒªãƒ³ã‚¯ç”Ÿæˆ â†’ {ãƒ•ãƒƒã‚¯} â†’ ã‚³ãƒ”ãƒ¼å‰ã¨ã—ã¦ãŠãã€‚
ãƒ•ãƒƒã‚¯ã§ã¯å¼ãŒä½¿ãˆã‚‹ã®ã§ãªã‚“ã§ã‚‚ã§ãã‚‹ã€‚å‹•çš„ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’åŠ ãˆãŸã‚Šã€é€£ç•ªã‚’æŒ¯ã£ãŸã‚Šã¨ã‹ï¼Ÿã€‚å˜ãªã‚‹æ–‡å­—åˆ—ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚ˆã‚Šã¯ã‚‹ã‹ã«å¼·åŠ›ã€‚èª°ã‹ãŒã‚‚ã£ã¨ä¾¿åˆ©ãªä½¿ã„æ–¹ã‚’ç·¨ã¿å‡ºã—ã¦ãã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚

** ã¾ã¨ã‚
0. ç§»æ¤æŠ€ã‚’è¦šãˆã¾ã—ãŸã€‚è¦ä»¶ãŒæ˜ç¢ºï¼‹å…ƒã‚½ãƒ¼ã‚¹ã‚’èª­ã‚€ã“ã¨ãŒã§ãã‚‹ã¨æ¥½ã€‚ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«é›†ä¸­ã§ãã¦ç¾å‘³ã—ã„ã€‚
1. ã¡ã‚‡ã£ã¨ã—ãŸä¸ä¾¿ã•ã¯å°‘ãªã„ã‚³ãƒ¼ãƒ‰ã§è§£æ±ºã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
2. ã”ãå˜ç´”ãªã‚³ãƒ³ã‚»ãƒ—ãƒˆã§ã‚‚ã€æ‹¡å¼µã®æ–¹å‘æ€§ã¯æ„å¤–ã¨å¤šã„ã§ã™ã€‚
