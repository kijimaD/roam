:PROPERTIES:
:ID:       1ad8c3d5-97ba-4905-be11-e6f2626127ad
:END:
#+title: Emacs
* 概要
Emacsはテキストエディタの1つ。
エディタに内蔵された言語[[id:c7e81fac-9f8b-4538-9851-21d4ff3c2b08][Emacs Lisp]]で柔軟に設定を変更できる。

柔軟性の一例。
- ブラウザ
- ミュージックプレーヤ
- Git + GitHubクライアント
- ウィンドウマネージャ
- フィードリーダー
- タスク管理
- 表計算
- 静的サイトジェネレータ

の機能を、共通の効率的なキーボード操作で扱える。
* Tasks
** TODO プロジェクトファイル限定のswitch-buffer。
projectile-switch-to-buffer (C-c p b)
** TODO キーバインドの一覧を表示
<F1> b
** TODO プロジェクトをag検索
projectile-ag (~C-c p s s~)
** TODO vtermでカッコが入力できない
vtermは互換性が高い[[id:585d3b5e-989d-4363-bcc3-894402fcfcf9][Shell]]のターミナルパッケージ。

カッコを自動入力するモードにしていると入力できなる。
なのでカッコ関係はコピペする羽目になる。
** TODO HIGでコピペしたときにおかしい
~highlight-indent-guides-mode~ がコピペしたときに表示がおかしい。
faceまでコピーするから仕方ないのかな。
** TODO vtermでコピーしたときにキルリングに入らない
一度読み取り専用バッファにして、コピーしないといけない。
** TODO GTAGSを使えるようにする
読むときにたどれないと不便。
* Memo
** パッケージメモ
- [[id:815a2c31-7ddb-40ad-bae0-f84e1cfd8de1][roam]]
- mermaid-mode
- alert.el
- writeroom-mode
- [[id:8c81068f-0e51-4d6d-bd1f-392ce8cb3a21][current-word-highlight]]
- [[id:f0cefeef-6f99-4ce2-bff7-db6e508f2c84][create-link]]
** ソースメモ
- org-lint
https://github.com/kijimaD/emacs/blob/master/lisp/org/org-lint.el#L124
- interactive
https://github.com/kijimaD/emacs/blob/master/src/callint.c#L37
- defun
https://github.com/kijimaD/emacs/blob/master/lisp/emacs-lisp/byte-run.el#L280
https://github.com/kijimaD/emacs/blob/master/lisp/emacs-lisp/cl-macs.el#L339
** projectile-toggle-between-implementation-and-test (~C-c p t~)
テストとプロダクトコードを切り替える。
** projectile-multi-occur (~C-c p o~)
プロジェクトで ~occur~ する。
occurの特徴はeでedit-modeに入れる点。一覧にして複数ファイルをそのまま置換できる。
** (magit-topic)
一覧でPRとIssueにアクセスできると行き来がしやすそう。
Forgeのトピック間移動がhelmでできたらいいのにな。
** [[id:7dab097c-60ba-43b9-949f-c58bf3151aa8][MySQL]]と接続して[[id:8b69b8d4-1612-4dc5-8412-96b431fdd101][SQL]]を直に実行する
#+begin_src
M-x customize-variable RET sql-connection-alist RET ...
M-x sql-connect
open buffer...
M-x sql-mode
M-x sql-set-sqli-buffer RET
sql-send-buffer (C-c C-b)
sqlup-capitalize-keywords-in-region (C-c u)
#+end_src
** Macでの置換
- Macでは ~query-replace~ (~M-%~)が奪われて押せないので、 ~query-replace-regexp~ (~C-M-%~)する。
** spring rspec
[[id:e04aa1a3-509c-45b2-ac64-53d69c961214][Rails]]でspringを走らせておくとテストが高速に動作する。

いつのまにかEmacsでspringが動かなくなっていた。コマンドでは ~spring rspec~ などで動かせるが、Emacsではふつうの ~bundle exec ...~ になっていた。前は早くできていたはず。ネットの記事を参考に修正した。

#+begin_quote
emacsのrspec-modeで、上記のようにしてspringを使うと、自動ではspringがONにならない。 これはtmpにpidファイルが作られないため。 強制的にspringを使うには、次のように設定する。
#+end_quote

  #+begin_src emacs-lisp
  (require 'rspec-mode)
  (defun rspec-spring-p ()
    (and rspec-use-spring-when-possible
         (stringp (executable-find "spring"))))
  #+end_src

springを自動で検出してくれるらしい(何より今までできてた)。
~spring status~ でspringが動いてるかチェックする。動いてなかったら ~spring rspec~ する。
** デバッグ起動
#+begin_src shell
$ emacs -q
# init読み込まない
$ emacs --debug-init
# デバッグモードで起動する
#+end_src
** ivy化
[[https://qiita.com/takaxp/items/2fde2c119e419713342b][helm を背に ivy の門を叩く - Qiita]]
** System Crafters IRC
#+begin_quote
erc-tls
irc.libera.chat
6697
/join #systemcrafters
#+end_quote
** 脚注
脚注使えるのは知らなかったな。[fn:1]

[fn:1] The link is: https://orgmode.org
** mermaid jsをEmacsで使うhttps://github.com/abrochard/mermaid-mode
mermaidはプレーンテキストで図を作れるツール。[[id:a6980e15-ecee-466e-9ea7-2c0210243c0d][JavaScript]]で書かれている。
#+begin_src shell
npm install -g @mermaid-js/mermaid-cli
#+end_src
して、C-cで画像にコンパイルできる。
** LinuxをEmacs風キーバインドにする
https://linuxfan.info/linux-emacs-keybindings-matome

#+begin_src shell
  # gnome
  gsettings set org.gnome.desktop.interface gtk-key-theme Emacs
  # MATE
  gsettings set org.mate.interface gtk-key-theme Emacs
  # Cinnamon
  gsettings set org.cinnamon.desktop.interface gtk-key-theme Emacs
#+end_src
** counsel-find-fileで新しいファイル
補完選択になってしまって新しくファイルが作れないとき。
C-M-jで新規作成できる。そんなのわかるか…。
READMEの最後に書かれてた、(setq ivy-use-selectable-prompt t)をしとくと上下選択できるようになる。
選択一覧にはでないのでわかりにくい。
* Archives
** DONE undo履歴を保持しないときがある
CLOSED: [2021-08-17 火 09:41]
3つくらいしか戻れないときがあり、原因は不明。
undo-treeで戻れる。
** DONE ~vterm-toggle~ をもっと良い感じに出てくるようにしたい。toggleでオフになったとき分割ウィンドウが消える。
CLOSED: [2021-05-30 日 00:25]
設定を追加した。
** DONE ~markdown-mode~ でHelm-M-xが作動しない。...emacs-mozcを使っていて日本語入力モードのときhelmがうまく作動しない。
CLOSED: [2021-05-30 日 00:25]
よくわからないのでclose。
** DONE 列名を表示する
CLOSED: [2021-07-26 月 09:41]
(global-display-line-numbers-mode)
linum-modeよりこっちのほうがいいらしい。
linum-modeは重かった。
外観も綺麗。
** DONE diredで直に編集する
CLOSED: [2021-06-23 水 01:34]
(wdired-change-to-wdired-mode)
編集モードにして ~C-c C-c~ で実行します。
** DONE 見出しレベル替え
CLOSED: [2021-06-23 水 01:34]
(org-cycle-level)
何も書いてない見出しでtab。
** DONE 見出し挿入
CLOSED: [2021-06-23 水 01:33]
C-enter
前の項目がリストでも見出しが挿入できる。
** DONE ~C-c n~
CLOSED: [2021-06-03 木 21:45]
roam のプレフィクスキー。
** DONE wdired-change-to-wdired-mode dired
CLOSED: [2021-06-03 木 21:45]
便利な置換。
** DONE org-mode の各種挿入 ~C-c C-,~
CLOSED: [2021-06-03 木 21:44]
** DONE ~projectile-find-file~ (~C-c p f~)
CLOSED: [2021-06-03 木 21:42]
プロジェクト全体のファイル名検索。
** DONE ~projectile-switch-project~ (~C-c p p~)
プロジェクトを切り替えます。
CLOSED: [2021-06-03 木 21:42]
** DONE ~robe-doc~ (~C-c C-d~)
CLOSED: [2021-06-03 木 21:42]
Rubyメソッドを調べられます。gemがあるプロジェクトのGemfileで ~pry~, ~pry-doc~ をインストールして実行するとpryが起動して、以後使えるようになります。これは補完の ~company.el~ と連携させているため、pryを起動しないことにはgemの補完は表示されません。
** DONE ~vterm-copy-mode~ → ~C-c C-t~
CLOSED: [2021-06-03 木 21:42]
vterm上で、eshellなどのように自由に動き回るモードです。
** DONE C-c C-w (org-refile)
CLOSED: [2021-07-26 月 09:41]
https://orgmode.org/manual/Refile-and-Copy.html#Refile-and-Copy
見出しの移動。
** DONE 使用パッケージで分岐するとき、どうやってbyte-compileエラーを回避するのか
CLOSED: [2021-08-21 Sat 23:47]
たとえばhelmを使ってるときはこれ、ivyのときはこれとかでrequireするものは変わるものだが。既存パッケージはどうしているのだろう。

↓とかやった。外部のコマンドは最初に定義しておいた。
#+begin_src emacs-lisp
(defvar w3m-current-url)
(declare-function w3m-current-title "ext:w3m-util")
#+end_src
** CLOSE Emacsをビルドしてみる
CLOSED: [2021-08-25 Wed 22:31]
https://systemcrafters.net/live-streams/august-20-2021/

この通りにやって簡単にできた。
** DONE roamリポジトリをサイト公開する
CLOSED: [2021-08-29 日 17:53]
どうにかして静的ページとして公開できるはず。
かっこいいのがなければ作る。

いい感じにやっているサイトはいくつもある。

- http://juanjose.garciaripoll.com/blog/org-mode-html-templates/index.html
- https://diego.codes/post/blogging-with-org/
- https://hugocisneros.com/org-config/#configuration
- https://hugocisneros.com/blog/my-org-roam-notes-workflow/
- https://doubleloop.net/2020/08/21/how-publish-org-roam-wiki-org-publish/
- https://notes.alexkehayias.com/org-roam/
- https://www.mtsolitary.com/20210318221148-emacs-configuration/#hugo-support
** DONE org-publishのスタイルを設定する
CLOSED: [2021-08-29 日 17:55]
https://ogbe.net/blog/blogging_with_org.html

contentのhtmlをいじることができなかったが、とりあえずcssで指定してOK。
** DONE autosaveが出てきてうざい
CLOSED: [2021-08-29 日 17:55]
Guixでは編集すると毎回プロンプトが出てくる。
#+begin_src emacs-lisp
  (defun ask-user-about-supersession-threat (fn)
    "blatantly ignore files that changed on disk"
  )
  (defun ask-user-about-lock (file opponent)
    "always grab lock"
  t)

  ;; or

  (setq revert-without-query '(".*"))
#+end_src
を実行したが、変わらなかった。

↓できた。
#+begin_src emacs-lisp
(setq auto-save-timeout 2)
(setq auto-save-visited-interval 2)
(setq auto-save-no-message t)
(auto-save-visited-mode)
#+end_src
** CLOSE Projectileの幅がせまくて見づらい
ほかのcompletionは幅いっぱいにハイライトされるが、projectileは文字のあるところしかハイライトされないので短い検索のときに見えにくい。たとえば ~counsel-find-file~ とか ~counsel-find-file~ と比べるとわかる。

counsel-projectileを使えば問題ない。でもデフォルトの動作がおかしいので修正したいところ。
いや、ivyの問題ぽい。ivy yasnippetをすると同じような状態になる。テーマを変えてもそうなる。

org-refileでも同じような感じ。要調査。
共通点は、右側にアノテーションが出ないときか。そのときはfaceが設定されないので右側まで伸びない。
** DONE org-mode のキーバインド
CLOSED: [2021-08-29 日 23:52]
見出し移動とか。
* References
- org-modeのキーバインド :: https://qiita.com/takaxp/items/a5a3383d7358c58240d0
