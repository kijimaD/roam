#+title: digger
* Todo
** 設定のファイル化
CDDAみたいに、設定類はすべてjsonかymlにする。
** プレイヤーキャラ以外を追加する
表示文字をキャラによって変える必要がある。
** ターン実装
getchでなんとなくターンぽくなっているが、移動以外でもターンが進んでしまう。
ターンが進むのは移動だけでよさそう。ローグライクだったら攻撃でも進むが、このゲームにはない。
** 戦闘モード追加する
** メニュー追加する
** 永続値をどこで持つか
ステートを切り替えても持ってないといけないものがある。
仲間のHPとか装備とか。そういうのをどこで保持すればいいんだろう。
** 戦闘の方はmemberにする
エンカウント型にすると、map上のシンボルが複数のキャラクターを持つことがありうる。
現状のCharacterと合わなくなるような気がする。
map上とbattle上のcharacterは別物だ。

map上の方はtankとかにするか。敵キャラはtankとは限らないわけだが。それに降車する可能性も。

安直な解決策はbattle_characterか。長いな。

=>マップの方はpartyにする。
戦闘の方をcharacterに。
あまり直感的ではないな。

戦闘の方はmemberにするとか。属してるニュアンスは出る。

いろいろ違うので敵と仲間は別にしよう。
* 設計
** 戦闘モード
#+begin_src

  oo`'._..---.___..-   oo`'._..---.___..-
 (_,-.        ,..'`  (_,-.        ,..'`
      `'.    ;            `'.    ;
         : :`                : :`
        _;_;                _;_;
ティラノ              ティラノ

ティラノ> 体当たりした
白瀬> 10のダメージを受けた
椿> 対物ライフル → ティラノに30のダメージ
石原> 木刀 → ティラノに5のダメージ

--------------------------------
→戦う　　|白瀬 HP: 55/20 SP: 40/30 **--- ****-
 逃げる　|椿　 HP: 90/84 SP: 50/20 ****- ***--
 アイテム|石原 HP: 80/80 SP: 50/24 ***** **---
 　　　　|
#+end_src
** 拠点メニューモード
拠点。
#+begin_src
→休憩
 合成
 アイテム
 仲間
 装備
 セーブ
 ロード
#+end_src

フィールドではメニューにはアクセスしない。
ステータスやアイテムへのショートカットキーを用意する。
** フィールドモード
- ターンベース
- イベントオブジェクトに接触して、別モードに遷移する

ステータス、アイテム、装備へのショートカットキーを用意する。
* 大TODO
- ローグライク … とりあえずこれをやる。
- エンカウント戦闘
- インベントリシステム
* Archive
** DONE 移動システム
CLOSED: [2021-06-26 土 21:31]
- 地形判定
** DONE マップをtxtファイルから読み込む
CLOSED: [2021-06-26 土 10:19]
** DONE mainファイル分割
CLOSED: [2021-06-24 木 23:45]
同じ形にした。
** DONE テスト追加
CLOSED: [2021-06-24 木 23:46]
** DONE テスト環境構築
CLOSED: [2021-06-24 木 23:46]
- 単独RSpec
- カバレッジ
** DONE 複数ウィンドウエリア
CLOSED: [2021-06-28 月 10:23]
メッセージエリア、ステータスエリアなどウィンドウにエリアを追加する。
** DONE component追加
CLOSED: [2021-06-29 火 10:05]
game_objectを構成するもの。直に起動されることはなく、object_poolにもaddされない。
** DONE inputに分割
CLOSED: [2021-07-03 土 12:45]
今はすべてfield_stateでやっているが、characterのcomponentでやるようにする。
** DONE 別入力
CLOSED: [2021-07-03 土 12:45]
とりあえず敵をランダム移動できるようにする。
** DONE message_displayとmessageの分割
CLOSED: [2021-07-03 土 00:09]
statsを作ってそこにmessageを入れることで対応した。
** DONE テストrequireを自動化する
CLOSED: [2021-07-03 土 12:46]
めんどいので。
** DONE RSpec lintを追加した
CLOSED: [2021-07-04 日 00:10]
その日の気分で書きがちなところに基準ができた。必須だな。
** DONE object_poolオブジェクト間の接触判定
CLOSED: [2021-07-04 日 16:50]
地形判定とは異なる。オブジェクト層で起こる反応。
game_objectとmapではやり方が異なる。
** DONE boxつけるとずれる問題
CLOSED: [2021-07-04 日 16:50]
範囲がわかりづらいのでつけたいが、横方向がずれてる。
最初の一行だけ正しくて、改行以降はインデントがセットされてない、みたいな状況か。
#+begin_src
 aaa
aaa
aaa
#+end_src
かな。

一行ずつ出力することで解決した。
** DONE 基地メニュー
CLOSED: [2021-07-04 日 21:24]
2つ目state。
まだ内容はない。
** DONE ウィンドウ分割
CLOSED: [2021-07-04 日 21:24]
対応の必要なし。

メインウィンドウにすべて表示してたが、分割したほうがやりやすそうなので分割する。
マップウィンドウ、メッセージウィンドウとか。

その場合、ウィンドウ構成がモードによって変わる。どうやって表現すればよいだろう。
うーん、やっぱり面倒なのでメインウィンドウに座標挿入でよさそう。

stateによって使い回せるしな。
** DONE ゲームのおおまかな計画をやる
CLOSED: [2021-07-07 水 21:18]
バトルディッガーにしようとうっすら考えてたが、さすがに丸パクはできないので、混ぜよう。
そろそろどういう仕様にするか決めないといけない段階。

合成システムはカンタンに実装できて奥深そうなんだよな。
なのでシステム的にはディッガーよりハタ人間。

- アイテム合成
** DONE フォント
CLOSED: [2021-07-07 水 21:18]
- Press Start 2p :: 横幅的には一番
- misaki font :: 日本語対応
** DONE AIキャラが消える問題
CLOSED: [2021-07-07 水 21:18]
updateはAIキャラが動かない。
drawは全員消える。

game_objectにupdate, drawメソッドがあると、componentのdraw, updateが上書きされるため起こる。
ai_inputはcomponentでupdateを使って入力を生成してるが、player_inputはbutton_downのため、問題が起きたり起きなかったりする。

drawでは機能しないのはなぜだ。処理の順番か。field_stateの処理の順番を並べ替えるとできた。
object_pool.draw
map.draw
の順番にしないといけない。
** DONE カメラ追加
CLOSED: [2021-07-07 水 21:19]
** DONE アイテム追加する
CLOSED: [2021-07-08 木 10:12]
game_objectのアイテムと、所持品としてのアイテムをどう分ければよいだろう。
少なくとも単語を分けることが必要そう。

pickupはいいセンいってるが、動作っぽい。
まあいいか。後からどうするか明確になってからで。
