<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-06-10 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>magit-forge</title>
<meta name="generator" content="Org mode">
<meta name="author" content="root">
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css' /><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Ultra&display=swap" rel="stylesheet"><link rel='stylesheet' href='css/site.css' /><link rel='stylesheet' href='css/code.css' />
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content">
<h1 class="title">magit-forge</h1>
<div id="outline-container-org989838c" class="outline-2">
<h2 id="org989838c"><a href="#org989838c">概要</a></h2>
<div class="outline-text-2" id="text-org989838c">
<p>
Forgeは<a href="20210508234743-emacs.html#ID-1ad8c3d5-97ba-4905-be11-e6f2626127ad">Emacs</a>packageの1つ。
<a href="20210922005248-magit.html#ID-5ba43a42-93cb-48fa-8578-0558c757493f">magit</a>のインターフェースで<a href="20210926103926-github.html#ID-6b889822-21f1-4a3e-9755-e3ca52fa0bc4">GitHub</a>などコードホスティングサービスを操作できる。
Magitと同じ操作でPull Requestに対してcheckoutなど<a href="20210901104129-git.html#ID-90c6b715-9324-46ce-a354-63d09403b066">Git</a>操作が行えたり、操作が高度に統合されている。
</p>

<dl class="org-dl">
<dt>Repository</dt><dd><a href="https://github.com/magit/forge">magit/forge</a></dd>
</dl>
</div>
</div>
<div id="outline-container-org2146506" class="outline-2">
<h2 id="org2146506"><a href="#org2146506">Memo</a></h2>
<div class="outline-text-2" id="text-org2146506">
</div>
<div id="outline-container-org2d68974" class="outline-3">
<h3 id="org2d68974"><a href="#org2d68974">URLを変えた場合の対応</a></h3>
<div class="outline-text-3" id="text-org2d68974">
<div class="org-src-container">
<pre class="src src-shell">git remote set-url origin git@github.com:user/repo.git
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>一度削除してからpull</label><pre class="src src-emacs-lisp">(forge-reset-database)
(forge-pull)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f1648c" class="outline-3">
<h3 id="org3f1648c"><a href="#org3f1648c">API token登録</a></h3>
<div class="outline-text-3" id="text-org3f1648c">
<p>
<a href="20210926103926-github.html#ID-6b889822-21f1-4a3e-9755-e3ca52fa0bc4">GitHub</a>でAPIトークンを発行し、マシンに登録する必要がある。
</p>

<p>
<code>~/.authinfo</code> に以下のような形式で書き込む。
</p>
<pre class="example">
machine api.github.com login kijimaD^forge password aaaaaaaaaaaaaaaaaaaaaaa
</pre>

<p>
<code>(forge-pull)</code> してみてできたら成功。
</p>

<p>
注意: すでにトークンで接続成功していた場合はキャッシュを削除しないと反映しない。
トークン再発行時は注意。
<code>(auth-source-forget-all-cached)</code>
</p>
</div>
</div>
<div id="outline-container-org97231ce" class="outline-3">
<h3 id="org97231ce"><a href="#org97231ce">issue comment</a></h3>
<div class="outline-text-3" id="text-org97231ce">
<p>
issueにコメントを追加する。
<code>C-c C-n</code>
<code>forge-create-post</code>
</p>
</div>
</div>
<div id="outline-container-org702ff7d" class="outline-3">
<h3 id="org702ff7d"><a href="#org702ff7d">buffer name</a></h3>
<div class="outline-text-3" id="text-org702ff7d">
<p>
buffer nameはmagitの関数を利用して生成している。だから同じ形式で利用できる。
さらにここにforge特有のformat設定を一層増やせばいいのかな。
</p>
</div>
</div>
</div>
<div id="outline-container-orgeacc9c6" class="outline-2">
<h2 id="orgeacc9c6"><a href="#orgeacc9c6">Tasks</a></h2>
<div class="outline-text-2" id="text-orgeacc9c6">
</div>
<div id="outline-container-org81c1eae" class="outline-3">
<h3 id="org81c1eae"><a href="#org81c1eae"><span class="todo TODO">TODO</span> 管理方法を確立する</a></h3>
<div class="outline-text-3" id="text-org81c1eae">
<p>
適当なため毎回magitのトップ画面に行って探している。
番号をorgに貼っておいて、それを開くとtopicを開くようにしたい。
</p>
</div>
</div>
<div id="outline-container-orgeaf7991" class="outline-3">
<h3 id="orgeaf7991"><a href="#orgeaf7991"><span class="todo TODO">TODO</span> tracked issueを表示する</a></h3>
</div>
<div id="outline-container-org5eea3bd" class="outline-3">
<h3 id="org5eea3bd"><a href="#org5eea3bd"><span class="todo TODO">TODO</span> 別windowで開けるようにする</a></h3>
<div class="outline-text-3" id="text-org5eea3bd">
<p>
magitのように、ユニバーサル引数を使って別windowで開けるようにしたい。
仕組みが違うみたいでforgeでどうやったらいいのかよくわからないな。
</p>

<ul class="org-ul">
<li>forge-visit 開く時の関数</li>
<li>forge-topic-setup-buffer</li>
<li>magit-setup-buffer</li>
<li>magit-setup-buffer-internal</li>
</ul>
</div>
</div>
<div id="outline-container-orgcd9805a" class="outline-3">
<h3 id="orgcd9805a"><a href="#orgcd9805a"><span class="todo TODO">TODO</span> どうやってissue, PRを辿れるか</a></h3>
<div class="outline-text-3" id="text-orgcd9805a">
<p>
#9999 とあった場合、visitするとブラウザが起動してしまう。
そうでなくて、forgeで開いてほしい。
</p>
</div>
</div>
<div id="outline-container-org46a26ef" class="outline-3">
<h3 id="org46a26ef"><a href="#org46a26ef"><span class="todo TODO">TODO</span> buffner name formatを設定可能にする</a></h3>
<div class="outline-text-3" id="text-org46a26ef">
<p>
バッファ名を <code>*forge: kijimad/emacs #10398 Add magit-forge settings</code> のようにtopic名を含めると、バッファ検索しやすくて便利。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">forge-topic-setup-buffer</span> (topic)
  (<span class="org-keyword">let*</span> ((repo  (forge-get-repository topic))
         (ident (concat (forge--topic-type-prefix topic)
                        (number-to-string (<span class="org-keyword">oref</span> topic number))))
         (name  (format <span class="org-string">"*forge: %s/%s %s %s*"</span>
                        (<span class="org-keyword">oref</span> repo owner)
                        (<span class="org-keyword">oref</span> repo name)
                        ident
                        (<span class="org-keyword">oref</span> topic title)))
         (magit-generate-buffer-name-function (<span class="org-keyword">lambda</span> (_mode _value) name))
         (current-repo (forge-get-repository nil))
         (default-directory (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> current-repo
                                     (eq (<span class="org-keyword">oref</span> current-repo id)
                                         (<span class="org-keyword">oref</span> repo id)))
                                default-directory
                              (<span class="org-keyword">or</span> (<span class="org-keyword">oref</span> repo worktree)
                                  default-directory))))
    (magit-setup-buffer #'forge-topic-mode t
      (forge-buffer-topic topic)
      (forge-buffer-topic-ident ident))))
</pre>
</div>

<p>
formatは <code>magit-buffer-name-format</code> を参考にすればよさそう。
</p>
</div>
</div>
</div>
<div id="outline-container-orgf251c19" class="outline-2">
<h2 id="orgf251c19"><a href="#orgf251c19">Reference</a></h2>
<div class="outline-text-2" id="text-orgf251c19">
</div>
<div id="outline-container-orga8b02df" class="outline-3">
<h3 id="orga8b02df"><a href="#orga8b02df"><a href="https://magit.vc/manual/forge/">Top (Forge User and Developer Manual)</a></a></h3>
<div class="outline-text-3" id="text-orga8b02df">
<p>
Forgeのマニュアル。
</p>
</div>
</div>
</div>
<div id="outline-container-orga5442ed" class="outline-2">
<h2 id="orga5442ed"><a href="#orga5442ed">Archives</a></h2>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"/>
</div>
</body>
</html>
