<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-07-03 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rust</title>
<meta name="generator" content="Org mode">
<meta name="author" content="root">
<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css' /><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Ultra&display=swap" rel="stylesheet"><link rel='stylesheet' href='css/site.css' /><link rel='stylesheet' href='css/code.css' />
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content">
<h1 class="title">Rust</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0846d21">概要</a></li>
<li><a href="#orgbf625db">Memo</a>
<ul>
<li><a href="#org986d3e8">マクロ作成</a></li>
<li><a href="#org52fb847">unwrap()は何か</a></li>
<li><a href="#org2e490f9">イテレータを定義する</a></li>
<li><a href="#org695c3a4">Box、スマートポインタは何か</a></li>
<li><a href="#org8f55069">変更を検知して自動ビルドする</a></li>
<li><a href="#orgcfc442c"><code>println!</code> マクロとは何か</a></li>
</ul>
</li>
<li><a href="#org83f20e4">パッケージ</a>
<ul>
<li><a href="#org2b93e33">EmacsをRustで書き直すプロジェクト</a></li>
<li><a href="#orgee3a29a">超高速検索できるripgrep</a></li>
<li><a href="#org2f060be">外観がかっこいいShell, nushell</a></li>
</ul>
</li>
<li><a href="#org6d528f5">Tasks</a>
<ul>
<li><a href="#org128490b">Rust の最初のステップ - Learn | Microsoft Docs</a></li>
<li><a href="#orga41bfd1"><span class="todo TODO">TODO</span> Introduction - Rust By Example 日本語版</a></li>
<li><a href="#org75df218"><span class="todo WIP">WIP</span> The Rust Programming Language 日本語版</a>
<ul>
<li><a href="#org5db7686"><span class="todo TODO">TODO</span> chapter1</a></li>
<li><a href="#orgfaff60a"><span class="todo TODO">TODO</span> chapter2</a></li>
<li><a href="#org126687b"><span class="todo TODO">TODO</span> chapter3</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9142a15">Reference</a>
<ul>
<li><a href="#org2d6e43d">序｜RustCoder ―― AtCoder と Rust で始める競技プログラミング入門</a></li>
<li><a href="#org6f457d3">Rust (プログラミング言語) - Wikipedia</a></li>
</ul>
</li>
<li><a href="#org0826e71">Archives</a>
<ul>
<li><a href="#orgc1e1a4b"><span class="done DONE">DONE</span> Getting started - Command Line Applications in Rust</a></li>
<li><a href="#org4d7d28f"><span class="done DONE">DONE</span> 手を動かして考えればよくわかる 高効率言語 Rust 書きかた・作りかた</a>
<ul>
<li><a href="#org1a1b5e6">構造体に実装する</a></li>
<li><a href="#org476d38c">None, Result</a></li>
</ul>
</li>
<li><a href="#orgf111011"><span class="done DONE">DONE</span> Introduction - Roguelike Tutorial - In Rust</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org0846d21" class="outline-2">
<h2 id="org0846d21"><a href="#org0846d21">概要</a></h2>
<div class="outline-text-2" id="text-org0846d21">
<p>
RustはC言語、C++の置換を目指した<a href="20210509101246-programming_language.html#ID-868ac56a-2d42-48d7-ab7f-7047c85a8f39">Programming Language</a>。
</p>

<ul class="org-ul">
<li>性能</li>
<li>メモリ安全性</li>
<li>安全な並行性</li>
</ul>

<p>
を特徴とする。
</p>

<p>
<a href="20210901100517-zig.html#ID-4270d99a-d2b5-429e-b33c-c2e097b20730">Zig</a>と方向性が同じ。
</p>
</div>
</div>
<div id="outline-container-orgbf625db" class="outline-2">
<h2 id="orgbf625db"><a href="#orgbf625db">Memo</a></h2>
<div class="outline-text-2" id="text-orgbf625db">
</div>
<div id="outline-container-org986d3e8" class="outline-3">
<h3 id="org986d3e8"><a href="#org986d3e8">マクロ作成</a></h3>
<div class="outline-text-3" id="text-org986d3e8">
<div class="org-src-container">
<pre class="src src-git-permalink">https://github.com/kd-collective/specs/blob/f07c484ad3caf8dccbf55c96af4ef1e3475dea28/specs-derive/src/lib.rs#L71-L75
</pre>
</div>

<div class="results" id="org3adefc7">
<p>
quote! {
    impl #impl_generics Component for #name #ty_generics #where_clause {
	type Storage = #storage&lt;Self&gt;;
    }
}
</p>

</div>
</div>
</div>

<div id="outline-container-org52fb847" class="outline-3">
<h3 id="org52fb847"><a href="#org52fb847">unwrap()は何か</a></h3>
<div class="outline-text-3" id="text-org52fb847">
<p>
unwrap() は、 Option&lt;T&gt; 型や Result&lt;T, E&gt; 型の値（つまり、何かしらの値を ラップ している値）から中身の値を取り出す関数。たとえば Option&lt;T&gt; 型の値に対して unwrap() を呼ぶと、それが内包する T 型の値を返す。それらの型には値が入ってない可能性もあり、入ってない場合にはunwrapは失敗する。
</p>

<p>
<a href="https://ja.stackoverflow.com/questions/1730/rust%E3%81%AEunwrap%E3%81%AF%E4%BD%95%E3%82%92%E3%81%99%E3%82%8B%E3%82%82%E3%81%AE%E3%81%A7%E3%81%99%E3%81%8B">rust - Rustの&ldquo;unwrap()&rdquo;は何をするものですか？ - スタック・オーバーフロー</a>
</p>
</div>
</div>
<div id="outline-container-org2e490f9" class="outline-3">
<h3 id="org2e490f9"><a href="#org2e490f9">イテレータを定義する</a></h3>
<div class="outline-text-3" id="text-org2e490f9">
<p>
<a href="https://docs.microsoft.com/ja-jp/learn/modules/rust-generic-types-traits/5-iterators">反復子を使用する - Learn | Microsoft Docs</a>
</p>

<div class="org-src-container">
<pre class="src src-rust">trait Iterator {
    type Item;
    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;
}

#[derive(Debug)]
struct Counter {
    length: usize,
    count: usize,
}

impl Counter {
    fn new(length: usize) -&gt; Counter {
        Counter {
            count: 0,
            length,
        }
    }
}

impl Iterator for Counter {
    type Item = usize;

    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {
        self.count += 1;
        if self.count &lt;= self.length {
            Some(self.count)
        } else {
            None
        }
    }
}

fn main() {
    for number in Counter::new(10) {
        println!("{}", number);
    }
}
</pre>
</div>

<div class="results" id="org2c44362">

</div>
</div>
</div>

<div id="outline-container-org695c3a4" class="outline-3">
<h3 id="org695c3a4"><a href="#org695c3a4">Box、スマートポインタは何か</a></h3>
<div class="outline-text-3" id="text-org695c3a4">
<p>
スマートポインタはポインタのように振る舞うだけでなく、追加のメタデータと能力があるデータ構造。
<a href="https://doc.rust-jp.rs/book-ja/ch15-00-smart-pointers.html">スマートポインタ - The Rust Programming Language 日本語版</a>
</p>

<p>
Rustでは、boxを使う。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>Boxは値5を示し、値5はヒープに保存されている</label><pre class="src src-rust">fn main() {
    let b = Box::new(5);
    println!("b = {}", b);
}
</pre>
</div>

<div class="results" id="org95d21b4">

</div>

<p>
Rustでスマートポインタを利用するのに使う。
スタックではなくヒープにデータを保存する。
</p>

<p>
使う場面。
</p>

<ul class="org-ul">
<li>コンパイル時にはサイズを知ることができない型があり、正確なサイズを要求する文脈でその型の値を使用する時</li>
<li>多くのデータがあり、その所有権を移したいが、その際にデータがコピーされないようにしたい時</li>
<li>値を所有する必要があり、特定の型であることではなく、特定のトレイトを実装する型であることのみ気にかけている時</li>
</ul>

<p>
<a href="https://doc.rust-jp.rs/book-ja/ch15-01-box.html">ヒープのデータを指すBox&lt;T&gt;を使用する - The Rust Programming Language 日本語版</a>
</p>
</div>
</div>
<div id="outline-container-org8f55069" class="outline-3">
<h3 id="org8f55069"><a href="#org8f55069">変更を検知して自動ビルドする</a></h3>
<div class="outline-text-3" id="text-org8f55069">
<p>
変更したら自動でcargo runしてほしいときがある。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>cargo-watchを使う</label><pre class="src src-shell">cargo install cargo-watch
cargo watch -x run
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcfc442c" class="outline-3">
<h3 id="orgcfc442c"><a href="#orgcfc442c"><code>println!</code> マクロとは何か</a></h3>
<div class="outline-text-3" id="text-orgcfc442c">
<div class="org-src-container">
<pre class="src src-rust">println!("hello world!");
println!("{} days", 31);
println!("{0}, this is {1}, {1}, this is {0}", "Alice", "Bob");
println!("{} of {:b} people know binary, the other half doesn't", 1, 2);
println!("{number:&gt;0width$}", number=1, width=6);
println!("{subject} {verb} {object}", object="the lazy dog", subject="the quick brown fox", verb="jumps over");
</pre>
</div>

<div class="results" id="org50d02ba">
<p>
hello world!
31 days
Alice, this is Bob, Bob, this is Alice
1 of 10 people know binary, the other half doesn&rsquo;t
000001
the quick brown fox jumps over the lazy dog
</p>

</div>

<p>
引数チェックもしてくれる。
</p>
<div class="org-src-container">
<pre class="src src-rust">println!("My name is {0}, {1} {0}", "Bond");
</pre>
</div>

<div class="results" id="org27bee4a">
<p>
error: invalid reference to positional argument 1 (there is 1 argument)
 &#x2013;&gt; /tmp/babel-wnDbpn/rust-W98kSP:2:27
</p>
<table>


<tbody>
<tr>
</tr>
</tbody>
</table>
<p>
2 | println!(&ldquo;My name is {0}, {1} {0}&rdquo;, &ldquo;Bond&rdquo;);
</p>
<table>


<colgroup>
<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">^^^</td>
</tr>
<tbody>
<tr>
</tr>
</tbody>
</table>
<p>
= note: positional arguments are zero-based
</p>

<p>
error: aborting due to previous error
</p>

</div>

<p>
マーカーの変更。
</p>
<div class="org-src-container">
<pre class="src src-rust">println!("This struct `{}` won't print...", Structure(3));
</pre>
</div>

<div class="results" id="orgb01e403">
<p>
error[E0425]: cannot find function, tuple struct or tuple variant `Structure` in this scope
 &#x2013;&gt; /tmp/babel-wnDbpn/rust-If17CF:2:45
</p>
<table>


<tbody>
<tr>
</tr>
</tbody>
</table>
<p>
2 | println!(&ldquo;This struct `{}` won&rsquo;t print&#x2026;&rdquo;, Structure(3));
</p>
<table>


<colgroup>
<col  class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">^^^^^^^^^ not found in this scope</td>
</tr>
</tbody>
</table>

<p>
error: aborting due to previous error
</p>

<p>
For more information about this error, try `rustc &#x2013;explain E0425`.
</p>

</div>

<div class="org-src-container">
<pre class="src src-rust">#[derive(Debug)]
struct Structure(i32);
println!("This struct `{:?}` won't print...", Structure(3));
</pre>
</div>

<div class="results" id="orgc7bb5a4">
<p>
This struct `Structure(3)` won&rsquo;t print&#x2026;
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-org83f20e4" class="outline-2">
<h2 id="org83f20e4"><a href="#org83f20e4">パッケージ</a></h2>
<div class="outline-text-2" id="text-org83f20e4">
</div>
<div id="outline-container-org2b93e33" class="outline-3">
<h3 id="org2b93e33"><a href="#org2b93e33"><a href="20210508234743-emacs.html#ID-1ad8c3d5-97ba-4905-be11-e6f2626127ad">Emacs</a>をRustで書き直すプロジェクト</a></h3>
<div class="outline-text-3" id="text-org2b93e33">
<p>
EmacsのC言語で書かれた部分をRustに書き直すリポジトリがある。
<a href="https://github.com/remacs/remacs">remacs/remacs: Rust Emacs</a>
</p>
</div>
</div>
<div id="outline-container-orgee3a29a" class="outline-3">
<h3 id="orgee3a29a"><a href="#orgee3a29a">超高速検索できるripgrep</a></h3>
<div class="outline-text-3" id="text-orgee3a29a">
<p>
高速検索するripgrepは、ほかのどのgrepツールより早いらしい。
</p>

<dl class="org-dl">
<dt>repository</dt><dd><a href="https://github.com/BurntSushi/ripgrep">BurntSushi/ripgrep</a></dd>
</dl>
</div>
</div>
<div id="outline-container-org2f060be" class="outline-3">
<h3 id="org2f060be"><a href="#org2f060be">外観がかっこいい<a href="20210606192338-shell.html#ID-585d3b5e-989d-4363-bcc3-894402fcfcf9">Shell</a>, nushell</a></h3>
<div class="outline-text-3" id="text-org2f060be">
<p>
<a href="20210915221421-systemcrafters.html#ID-fa497359-ae3f-494a-b24a-9822eefe67ad">System Crafters</a>の動画<a href="https://www.youtube.com/watch?v=IHeKUeO7bpo">Integrating Nushell with Emacs</a>のコラボ回で出たパッケージ。
リッチな出力形式、便利コマンドがすごい。
</p>
<dl class="org-dl">
<dt>repository</dt><dd><a href="https://github.com/nushell/nushell">nushell/nushell: A new type of shell</a></dd>
</dl>
</div>
</div>
</div>
<div id="outline-container-org6d528f5" class="outline-2">
<h2 id="org6d528f5"><a href="#org6d528f5">Tasks</a></h2>
<div class="outline-text-2" id="text-org6d528f5">
</div>
<div id="outline-container-org128490b" class="outline-3">
<h3 id="org128490b"><a href="#org128490b"><a href="https://docs.microsoft.com/ja-jp/learn/paths/rust-first-steps/">Rust の最初のステップ - Learn | Microsoft Docs</a></a></h3>
<div class="outline-text-3" id="text-org128490b">
<p>
Microsoftのチュートリアル。
</p>
</div>
</div>
<div id="outline-container-orga41bfd1" class="outline-3">
<h3 id="orga41bfd1"><a href="#orga41bfd1"><span class="todo TODO">TODO</span> <a href="https://doc.rust-jp.rs/rust-by-example-ja/">Introduction - Rust By Example 日本語版</a></a></h3>
</div>
<div id="outline-container-org75df218" class="outline-3">
<h3 id="org75df218"><a href="#org75df218"><span class="todo WIP">WIP</span> <a href="https://doc.rust-jp.rs/book-ja/title-page.html">The Rust Programming Language 日本語版</a></a></h3>
<div class="outline-text-3" id="text-org75df218">
<ul class="org-ul">
<li>10</li>
</ul>
</div>
<div id="outline-container-org5db7686" class="outline-4">
<h4 id="org5db7686"><a href="#org5db7686"><span class="todo TODO">TODO</span> chapter1</a></h4>
</div>
<div id="outline-container-orgfaff60a" class="outline-4">
<h4 id="orgfaff60a"><a href="#orgfaff60a"><span class="todo TODO">TODO</span> chapter2</a></h4>
</div>
<div id="outline-container-org126687b" class="outline-4">
<h4 id="org126687b"><a href="#org126687b"><span class="todo TODO">TODO</span> chapter3</a></h4>
</div>
</div>
</div>
<div id="outline-container-org9142a15" class="outline-2">
<h2 id="org9142a15"><a href="#org9142a15">Reference</a></h2>
<div class="outline-text-2" id="text-org9142a15">
</div>
<div id="outline-container-org2d6e43d" class="outline-3">
<h3 id="org2d6e43d"><a href="#org2d6e43d"><a href="https://zenn.dev/toga/books/rust-atcoder/viewer/01-intro">序｜RustCoder ―― AtCoder と Rust で始める競技プログラミング入門</a></a></h3>
<div class="outline-text-3" id="text-org2d6e43d">
<p>
入門本。
</p>
</div>
</div>
<div id="outline-container-org6f457d3" class="outline-3">
<h3 id="org6f457d3"><a href="#org6f457d3"><a href="https://ja.wikipedia.org/wiki/Rust_(%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9E)">Rust (プログラミング言語) - Wikipedia</a></a></h3>
</div>
</div>
<div id="outline-container-org0826e71" class="outline-2">
<h2 id="org0826e71"><a href="#org0826e71">Archives</a></h2>
<div class="outline-text-2" id="text-org0826e71">
</div>
<div id="outline-container-orgc1e1a4b" class="outline-3">
<h3 id="orgc1e1a4b"><a href="#orgc1e1a4b"><span class="done DONE">DONE</span> <a href="https://rust-cli.github.io/book/index.html">Getting started - Command Line Applications in Rust</a></a></h3>
<div class="outline-text-3" id="text-orgc1e1a4b">
<p>
コマンドラインプログラムを作るチュートリアル。
</p>
</div>
</div>
<div id="outline-container-org4d7d28f" class="outline-3">
<h3 id="org4d7d28f"><a href="#org4d7d28f"><span class="done DONE">DONE</span> <a href="https://www.amazon.co.jp/-/en/%E3%82%AF%E3%82%B8%E3%83%A9%E9%A3%9B%E8%A1%8C%E6%9C%BA/dp/4802613512/ref=sr_1_5?crid=14EZ2K0WKN0UY&amp;keywords=Rust&amp;qid=1648043657&amp;sprefix=rus%2Caps%2C165&amp;sr=8-5">手を動かして考えればよくわかる 高効率言語 Rust 書きかた・作りかた</a>&#xa0;&#xa0;&#xa0;<span class="tag"><span class="Read">Read</span></span></a></h3>
<div class="outline-text-3" id="text-org4d7d28f">
</div>
<div id="outline-container-org1a1b5e6" class="outline-4">
<h4 id="org1a1b5e6"><a href="#org1a1b5e6">構造体に実装する</a></h4>
<div class="outline-text-4" id="text-org1a1b5e6">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>型に実装する</label><pre class="src src-rust">    fn main() {
      let body = Body::new(163.0, 75.2, "田中");
      body.print_result();
      let body = Body::new(158.2, 55.0, "鈴木");
      body.print_result();
      let body = Body::new(174.2, 54.2, "井上");
      body.print_result();
    }

  struct BmiRange {
      min: f64,
      max: f64,
      label: String,
  }

  impl BmiRange {
    fn new(min: f64, max: f64, label: &amp;str) -&gt; Self {
      BmiRange{ min, max, label: label.to_string() }
    }

    fn test(&amp;self, v: f64) -&gt; bool {
      (self.min &lt;= v) &amp;&amp; (v &lt; self.max)
    }
  }

  struct Body {
    height: f64,
    weight: f64,
    name: String,
  }

  impl Body {
    fn new(height: f64, weight: f64, name: &amp;str) -&gt; Self {
        Body{ height, weight, name: name.to_string() }
    }

    fn calc_bmi(&amp;self) -&gt; f64 {
      self.weight / (self.height / 100.0).powf(2.0)
    }

    fn print_result(&amp;self) {
      let bmi = self.calc_bmi();
      let bmi_list = [
        BmiRange::new(0.0, 18.5, "低体重"),
        BmiRange::new(18.5, 25.0, "普通体重"),
        BmiRange::new(25.0, 30.0, "肥満1度"),
        BmiRange::new(30.0, 35.0, "肥満2度"),
        BmiRange::new(35.0, 40.0, "肥満3度"),
      ];
      let mut result = String::from("不明");
      for range in bmi_list {
        if range.test(bmi) {
          result = range.label.clone();
          break;
        }
      }
      println!("{}さん、 BMI={:.1}, 判定={}",
      self.name, bmi, result);
    }
  }
main()
</pre>
</div>

<div class="results" id="org4658de9">
<p>
田中さん、 BMI=28.3, 判定=肥満1度
鈴木さん、 BMI=22.0, 判定=普通体重
井上さん、 BMI=17.9, 判定=低体重
()
</p>

</div>
</div>
</div>
<div id="outline-container-org476d38c" class="outline-4">
<h4 id="org476d38c"><a href="#org476d38c">None, Result</a></h4>
<div class="outline-text-4" id="text-org476d38c">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>列挙型を使う</label><pre class="src src-rust">struct Counter {
  value: i64,
}

impl Counter {
  fn new() -&gt; Self {
    Counter { value: 0 }
  }

  fn inc(&amp;mut self) {
    self.value += 1;
    println!("value={}", self.value);
  }
}

fn count(counter: Option&lt;&amp;mut Counter&gt;) {
  match counter{
    None =&gt; return,
    Some(c) =&gt; c.inc(),
  };
}

fn main() {
  let mut a = Counter::new();
  count(Some(&amp;mut a));
  count(Some(&amp;mut a));
  let a = None;
  count(a);
}
main();
</pre>
</div>

<div class="results" id="org0366ccf">
<p>
value=1
value=2
()
</p>

</div>
</div>
</div>
</div>
<div id="outline-container-orgf111011" class="outline-3">
<h3 id="orgf111011"><a href="#orgf111011"><span class="done DONE">DONE</span> <a href="https://bfnightly.bracketproductions.com/">Introduction - Roguelike Tutorial - In Rust</a></a></h3>
<div class="outline-text-3" id="text-orgf111011">
<p>
<a href="20220319131144-roguelike.html#ID-50ac66da-89f2-42dc-a746-d20b041d06ae">roguelike</a>を作る長大なチュートリアル。
とりあえず14章までやり、理解を確かめるため自作改造フェーズに入った。
残りの部分はチュートリアルとしてやるというより、自作するうえで都度参照していく。
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"/>
</div>
</body>
</html>
