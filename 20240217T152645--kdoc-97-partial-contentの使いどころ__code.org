:properties:
:ID: 20240217T152645
:end:
#+title:      KDOC 97: Partial Contentã®ä½¿ã„ã©ã“ã‚
#+date:       [2024-02-17 Sat 15:26]
#+filetags:   :code:
#+identifier: 20240217T152645

* ã“ã®æ–‡æ›¸ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
:LOGBOOK:
CLOCK: [2024-02-17 Sat 16:18]--[2024-02-17 Sat 16:43] =>  0:25
CLOCK: [2024-02-17 Sat 15:52]--[2024-02-17 Sat 16:17] =>  0:25
CLOCK: [2024-02-17 Sat 15:26]--[2024-02-17 Sat 15:51] =>  0:25
:END:
- ä½œæˆ
  - [X] 2024-02-17 è²´å³¶
- ãƒ¬ãƒ“ãƒ¥ãƒ¼
  - [X] 2024-02-25 è²´å³¶
* æ¦‚è¦
CDNã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°ã‚’è¦‹ã¦ã„ã¦ã€HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ ~200~ ã«æ··ã˜ã£ã¦ ~206~ ãŒã‚ã£ãŸã€‚ã“ã‚ŒãŒä½•ã‹ã‚’æ•™ãˆã¦ã‚‚ã‚‰ã£ãŸã®ã§ãƒ¡ãƒ¢ã™ã‚‹ã€‚

* ã‚¤ãƒ³ãƒˆãƒ­
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹ã€‚

[[https://developer.mozilla.org/ja/docs/Web/HTTP/Status/206][206 Partial Content - HTTP | MDN]]

#+begin_quote
HTTP 206 Partial Content ã¯æˆåŠŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã€ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸã—ãŸã“ã¨ã€ãã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã® Range ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¨˜è¿°ã•ã‚ŒãŸé€šã‚Šã€è¦æ±‚ã•ã‚ŒãŸç¯„å›²ã®ãƒ‡ãƒ¼ã‚¿ãŒæœ¬æ–‡ã«å«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚
#+end_quote

ã“ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯ã©ã†ã„ã†ã¨ãã‹ã€‚

- URLãŒç”»åƒã ã£ãŸå ´åˆã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã‚’è¡¨ç¤ºã—ãŸã„ã¨ã

  Slackãªã‚“ã‹ã«ã‚ã‚‹æ©Ÿèƒ½ã€‚å…ˆã«ãã®URLã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ä¸€éƒ¨ã ã‘å–å¾—ã™ã‚‹(ç”»åƒã®å ´åˆãƒã‚¤ãƒŠãƒª)ã€‚ä¸€éƒ¨å–å¾—ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦åˆ¤å®šã™ã‚‹ã€‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã¨ãªã£ãŸã‚‰ã€ã‚‚ã†ä¸€åº¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’å–å¾—ã—ã¦ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã¨ã—ã¦ã‚»ãƒƒãƒˆã™ã‚‹ã€‚1å›žã‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ®µéšŽã§ã™ã¹ã¦å–å¾—ã™ã‚‹æ„å‘³ã¯ãªã„ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€éƒ¨ã ã‘ã‚’å–å¾—ã—ã¦ãã‚‹ã€‚

- å‹•ç”»å†ç”Ÿ

  é€”ä¸­ã‹ã‚‰å†ç”Ÿã—ã¦ã„ã‚‹ã®ã«ã€å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€åˆã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã™ã‚‹ã®ã¯æ„å‘³ãŒãªã„ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ã‚‹ç¯„å›²ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ä¸€éƒ¨ã ã‘ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹ã€‚å†ç”Ÿä½ç½®ã‹ã‚‰20ç§’é–“åˆ†ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€ã¿ãŸã„ãªæ„Ÿã˜ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’æ–­ç¶šçš„ã«èµ°ã‚‰ã›ã‚‹ã“ã¨ã§ãƒªã‚½ãƒ¼ã‚¹ã®ç„¡é§„ã‚’ãªãã—ã€ã©ã“ã‹ã‚‰ã§ã‚‚å†ç”Ÿã§ãã‚‹ã€‚

* æ¤œè¨¼
å®Ÿéš›ã®å‹•ãã‚’[[id:b11fb9a4-0a26-4354-bc60-6c755c256b21][curl]]ã§ç¢ºã‹ã‚ã‚‹ã€‚ãƒªãƒ³ã‚¯å…ˆã®ãƒã‚¤ãƒŠãƒªã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ã‚’ç¢ºèªã™ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã€‚å¯¾å¿œã—ã¦ãªã„ã‚µãƒ¼ãƒã§ã‚„ã£ã¦ã‚‚RangeæŒ‡å®šã¯ç„¡è¦–ã•ã‚Œã‚‹ã ã‘ãªã®ã§ã€[[id:39f0af27-f685-4ce5-beac-a3398f648ba4][Wikipedia]]ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã‚µãƒ¼ãƒã§ç¢ºã‹ã‚ã‚‹ã€‚

ã¾ãšã€ç¯„å›²æŒ‡å®šã—ãªã„å ´åˆã€‚ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚ç¨®åˆ¥ã‚’ç¢ºèªã—ãŸã„ã ã‘ãªã®ã«ã‚‚ã£ãŸã„ãªã„ã€‚

#+caption: ç”»åƒãƒã‚¤ãƒŠãƒªã‚’å–å¾—ã—ã¦ãƒã‚§ãƒƒã‚¯ã™ã‚‹
#+begin_src shell :results raw
  tmpfile=$(mktemp)
  result=`curl -v --output $tmpfile https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Wikipedia-logo-v2.svg/100px-Wikipedia-logo-v2.svg.png`
  file -b --mime-type $tmpfile
  rm $tmpfile
#+end_src

#+RESULTS:
#+begin_src
image/png
#+end_src

â†“ã“ã®ã¨ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ+ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ã“ã†ãªã‚‹ã€‚

#+begin_src
> GET /wikipedia/commons/thumb/8/80/Wikipedia-logo-v2.svg/100px-Wikipedia-logo-v2.svg.png HTTP/2
> Host: upload.wikimedia.org
> User-Agent: curl/8.4.0
> Accept: */*
>

< HTTP/2 200 ðŸ‘ˆ
< date: Sat, 17 Feb 2024 02:23:17 GMT
< etag: c4e5e81aa0475e2f1dae37acfadacd6c
< server: ATS/9.1.4
< content-type: image/png
< content-disposition: inline;filename*=UTF-8''Wikipedia-logo-v2.svg.png
< last-modified: Sun, 10 Sep 2023 12:27:10 GMT
< content-length: 14729 ðŸ‘ˆ
< age: 16405
< x-cache: cp5032 miss, cp5032 hit/117
< x-cache-status: hit-front
< server-timing: cache;desc="hit-front", host;desc="cp5032"
< strict-transport-security: max-age=106384710; includeSubDomains; preload
< report-to: { "group": "wm_nel", "max_age": 604800, "endpoints": [{ "url": "https://intake-logging.wikimedia.org/v1/events?stream=w3c.reportingapi.network_error&schema_uri=/w3c/reportingapi/network_error/1.0.0" }] }
< nel: { "report_to": "wm_nel", "max_age": 604800, "failure_fraction": 0.05, "success_fraction": 0.0}
< x-client-ip: 240b:10:91c1:d500:877b:f95b:ff57:d2fc
< x-content-type-options: nosniff
< access-control-allow-origin: *
< access-control-expose-headers: Age, Date, Content-Length, Content-Range, X-Content-Duration, X-Cache
< timing-allow-origin: *
< accept-ranges: bytes
<
#+end_src

- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹200ã‚’è¿”ã—ã¦ã„ã‚‹
- content-lengthã¯1ä¸‡ã‚’è¶…ãˆã¦ã„ã‚‹

æ¬¡ã«ã€Rangeã‚’æŒ‡å®šã—ã¦çµæžœã‚’æ¯”è¼ƒã™ã‚‹ã€‚ä¸€éƒ¨ã ã‘å–å¾—ã™ã‚‹ã®ã§ç„¡é§„ãªè³‡æºã‚’ä½¿ã‚ãšç’°å¢ƒã«å„ªã—ã„ã€‚curlã§ã¯ ~r~ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦æŒ‡å®šã™ã‚‹ã€‚

#+caption: ç¯„å›²ã‚’æŒ‡å®šã™ã‚‹
#+begin_src shell :results raw
  tmpfile=$(mktemp)
  result=`curl -v --output $tmpfile -r 0-100 https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Wikipedia-logo-v2.svg/100px-Wikipedia-logo-v2.svg.png`
  file -b --mime-type $tmpfile
  rm $tmpfile
#+end_src

#+RESULTS:
#+begin_src
image/png
#+end_src

â†‘ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã‚ã‚‹ã®ã§ã€ãƒã‚¤ãƒŠãƒªãŒä¸€éƒ¨ã ã‘ã§ã‚‚åˆ¤å®šã§ãã‚‹ã®ã‚’ç¢ºèªã§ããŸã€‚

â†“ã“ã®ã¨ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ+ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯ã“ã†ãªã‚‹ã€‚

#+begin_src
> GET /wikipedia/commons/thumb/8/80/Wikipedia-logo-v2.svg/100px-Wikipedia-logo-v2.svg.png HTTP/2
> Host: upload.wikimedia.org
> Range: bytes=0-100 ðŸ‘ˆ
> User-Agent: curl/8.4.0
> Accept: */*
>
< HTTP/2 206 ðŸ‘ˆ
< date: Sat, 17 Feb 2024 02:23:17 GMT
< etag: c4e5e81aa0475e2f1dae37acfadacd6c
< server: ATS/9.1.4
< content-type: image/png
< content-disposition: inline;filename*=UTF-8''Wikipedia-logo-v2.svg.png
< last-modified: Sun, 10 Sep 2023 12:27:10 GMT
< age: 18113
< x-cache: cp5032 miss, cp5032 hit/128
< x-cache-status: hit-front
< server-timing: cache;desc="hit-front", host;desc="cp5032"
< strict-transport-security: max-age=106384710; includeSubDomains; preload
< report-to: { "group": "wm_nel", "max_age": 604800, "endpoints": [{ "url": "https://intake-logging.wikimedia.org/v1/events?stream=w3c.reportingapi.network_error&schema_uri=/w3c/reportingapi/network_error/1.0.0" }] }
< nel: { "report_to": "wm_nel", "max_age": 604800, "failure_fraction": 0.05, "success_fraction": 0.0}
< x-client-ip: 240b:10:91c1:d500:877b:f95b:ff57:d2fc
< x-content-type-options: nosniff
< access-control-allow-origin: *
< access-control-expose-headers: Age, Date, Content-Length, Content-Range, X-Content-Duration, X-Cache
< timing-allow-origin: *
< accept-ranges: bytes
< content-range: bytes 0-100/14729
< content-length: 101 ðŸ‘ˆ
<
#+end_src

- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«Rangeãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¿½åŠ ã•ã‚ŒãŸ
- HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹206ã‚’è¿”ã—ã¦ã„ã‚‹
- content-lengthãŒæŒ‡å®šã—ãŸã‚µã‚¤ã‚ºã«ãªã£ã¦ã„ã‚‹

ã¨ã„ã†ã“ã¨ã§ã€ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€éƒ¨ã ã‘å¿…è¦ãªã¨ãã¯206ã‚’ä½¿ã†ã€‚

* é–¢é€£
- [[id:20240209T111023][KDOC 83: CORSã‚’ç¢ºèªã™ã‚‹æ–¹æ³•]]ã€‚curlã§èª¿ã¹ã‚‹ã¤ãªãŒã‚Š
