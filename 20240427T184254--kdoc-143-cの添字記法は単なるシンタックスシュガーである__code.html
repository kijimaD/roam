<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-07-10 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KDOC 143: Cの添字記法は単なるシンタックスシュガーである</title>
<meta name="generator" content="Org mode">
<meta name="author" content="root">
<link rel='shortcut icon' type='image/x-icon' href='/roam/favicon.ico' /><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css' /><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css' /><link rel='stylesheet' href='../css/site.css' /><link rel='stylesheet' href='../roam/css/code.css' /><link rel='stylesheet' href='css/site.css' /><link rel='stylesheet' href='css/code.css' />
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content">
<h1 class="title">KDOC 143: Cの添字記法は単なるシンタックスシュガーである</h1>

<div id="outline-container-org4b1c2c9" class="outline-2">
<h2 id="org4b1c2c9"><a href="#org4b1c2c9">この文書のステータス</a></h2>
<div class="outline-text-2" id="text-org4b1c2c9">
<ul class="org-ul">
<li>作成
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-04-29 貴島</li>
</ul></li>
<li>レビュー
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-05-06 貴島</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org3f5c893" class="outline-2">
<h2 id="org3f5c893"><a href="#org3f5c893">概要</a></h2>
<div class="outline-text-2" id="text-org3f5c893">
<p>
<a href="20210911104632-c_language.html#ID-656a0aa4-e5d3-416f-82d5-f909558d0639">C language</a>での配列の添字記法は、単なるポインタ操作のシンタックスシュガーになっている。添字の数値を、単純に配列の先頭をさすポインタに足している。 <code>arr[1]</code> は、 <code>*(arr+1)</code> とも書ける。
</p>

<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>

<span class="org-type">void</span> <span class="org-function-name">main</span>() {
  <span class="org-type">int</span> <span class="org-variable-name">nums</span>[3] = {1, 2, 3};
  <span class="org-type">int</span> <span class="org-variable-name">a</span>;
  <span class="org-comment-delimiter">// </span><span class="org-comment">&#21516;&#12376;&#24847;&#21619;&#12398;&#12373;&#12414;&#12374;&#12414;&#12394;&#26360;&#12365;&#26041;</span>
  printf(<span class="org-string">"%d\n"</span>, nums[1]);
  printf(<span class="org-string">"%d\n"</span>, *(nums+1));
  printf(<span class="org-string">"%d\n"</span>, 1[nums]);
}
</pre>
</div>

<pre class="example">
2
2
2
</pre>

<p>
これを、アセンブリを見て確かめる。
</p>
</div>
</div>

<div id="outline-container-org69c36c0" class="outline-2">
<h2 id="org69c36c0"><a href="#org69c36c0">実演</a></h2>
<div class="outline-text-2" id="text-org69c36c0">
<p>
↓生成されるアセンブリが全く同じなのを確認した。
</p>

<iframe width="800px" height="200px" src="https://godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,selection:(endColumn:2,endLineNumber:6,positionColumn:2,positionLineNumber:6,selectionStartColumn:2,selectionStartLineNumber:6,startColumn:2,startLineNumber:6),source:'void+main()+%7B%0A++++int+nums%5B3%5D+%3D+%7B1,+2,+3%7D%3B%0A++++int+a%3B%0A++++a+%3D+nums%5B1%5D%3B%0A++++a+%3D+*(nums%2B1)%3B%0A%7D'),l:'5',n:'0',o:'C+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:rv32-cgcctrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'1',libraryCode:'0',trim:'0',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:___c,libs:!(),options:'',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:1),l:'5',n:'0',o:'+RISC-V+(32-bits)+gcc+(trunk)+(Editor+%231)',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>

<p>
アセンブリに、添字で指定したままの数値は登場しない。アドレス計算された後の値になっている。コードに現れる添字はあくまでインデックスであって、配列の型の大きさによってアドレスに足す値は変わる。コンパイラは型情報を読んで、要素のアドレスを計算してくれている。
</p>
</div>
</div>

<div id="outline-container-org461caf4" class="outline-2">
<h2 id="org461caf4"><a href="#org461caf4">関連</a></h2>
<div class="outline-text-2" id="text-org461caf4">
<ul class="org-ul">
<li><a href="20240427T113714--kdoc-140-『自作エミュレータで学ぶx86アーキテクチャ』__book.html#ID-20240427T113714">KDOC 140: 『自作エミュレータで学ぶx86アーキテクチャ』</a>。とても詳しく解説されていたので、試した</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"/>
</div>
</body>
</html>
