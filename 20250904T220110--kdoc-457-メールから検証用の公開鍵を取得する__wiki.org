:properties:
:ID: 20250904T220110
:mtime:    20250904222457
:ctime:    20250904220120
:end:
#+title:      KDOC 457: メールから検証用の公開鍵を取得する
#+date:       [2025-09-04 Thu 22:01]
#+filetags:   :wiki:
#+identifier: 20250904T220110

* この文書のステータス
- 作成
  - [X] 2025-09-04 貴島
- レビュー
  - [X] 2025-10-18 貴島

* 概要

電子メールでは、署名によって内容が改ざんされていないか確かめるためのDKIMという仕組みがある。Amazonから届いた実際のメールを題材に、手でDKIMの公開鍵取得までをやってみる。

Gmailで、オリジナルメッセージを見る。

#+caption: オリジナルメッセージで見られる実際の値。DKIM-Signatureヘッダだけを抜粋した
#+begin_src shell
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/simple; s=gdwg2y3kokkkj5a55z2ilkup5wp5hhxx; d=amazonses.com; t=1756980149; h=Date:From:To:Message-ID:Subject:MIME-Version:Content-Type:Feedback-ID; bh=JY9SVohDFF5HNK0MR1PTlS9ApqBk/4IeBWUJIeo1jQ8=; b=nVfv7S+rA5hxIqK7G8kNasm4mA5z2HBhHWKCNIAvrUX+uyGNTmaPmU+sDPH9grWU 8Oun9qI4DmCPjtGXA8Rzv7Z2OJNm+Ov3I41ULFqyHq3EcIfqD1DASGktAnlmK90I409 Ya8TkXjIeP3twCrN2rkAxoi5Ta3KD96xLn/QpKgE=
#+end_src

- d(domain) = ~amazonses.com~
- s(selector) = ~gdwg2y3kokkkj5a55z2ilkup5wp5hhxx~
- 固定のフォーマット ~_domainkey~

これらを合わせてドメイン名 ~_gdwg2y3kokkkj5a55z2ilkup5wp5hhxx._domainkey.amazonses.com~ を作る(DKIM 公開鍵レコード名)。

#+caption: TXTレコードを問い合わせる
#+begin_src shell
host -t TXT gdwg2y3kokkkj5a55z2ilkup5wp5hhxx._domainkey.amazonses.com
#+end_src

#+RESULTS:
#+begin_src
gdwg2y3kokkkj5a55z2ilkup5wp5hhxx._domainkey.amazonses.com is an alias for gdwg2y3kokkkj5a55z2ilkup5wp5hhxx.dkim.amazonses.com.
gdwg2y3kokkkj5a55z2ilkup5wp5hhxx.dkim.amazonses.com descriptive text "p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC3RQOLRcTuQR8t2H9bqRtNvhXw+A88R6LfdbKF1Lvs52/Si8S4yvgYRo9q+R/nawJGT0R8rFeOnIe/QXHRTJbwzs2DEeqNwheI7fbfP+Di1wa+ZP1xwwh3wXcvu5DwvVh/9UEZeMjtyM5vJd5TSYdOmwXsXPBRIdV52ol2WmoEmQIDAQAB"
#+end_src

得られた ~p~ の値が公開鍵。

* 関連
なし。
