<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-07-12 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KDOC 94: 2&gt;&amp;1の意味</title>
<meta name="generator" content="Org mode">
<meta name="author" content="root">
<link rel='shortcut icon' type='image/x-icon' href='/roam/favicon.ico' /><link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css' /><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css' /><link rel='stylesheet' href='../css/site.css' /><link rel='stylesheet' href='../roam/css/code.css' /><link rel='stylesheet' href='css/site.css' /><link rel='stylesheet' href='css/code.css' />
</head>
<body>
<div id="preamble" class="status">
<div><div class="header"><div class="container"><div class="row"><div class="col-sm-12 col-md-12"><nav class="navbar navbar-light"/></div></div></div></div></div>
</div>
<div id="content">
<h1 class="title">KDOC 94: 2&gt;&amp;1の意味</h1>

<div id="outline-container-org6c97bda" class="outline-2">
<h2 id="org6c97bda"><a href="#org6c97bda">この文書のステータス</a></h2>
<div class="outline-text-2" id="text-org6c97bda">
<ul class="org-ul">
<li>作成
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-02-14 貴島</li>
</ul></li>
<li>レビュー
<ul class="org-ul">
<li class="on"><input type='checkbox' checked='checked' /> 2024-02-18 貴島</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgacc2fd3" class="outline-2">
<h2 id="orgacc2fd3"><a href="#orgacc2fd3">概要</a></h2>
<div class="outline-text-2" id="text-orgacc2fd3">
<p>
<a href="20210606192338-shell.html#ID-585d3b5e-989d-4363-bcc3-894402fcfcf9">Shell</a>に、標準出力と標準エラーをまとめる <code>2&gt;&amp;1</code> という書き方がある。よくコマンドの実行結果を保存するのに使う。標準出力と、標準エラー出力をまとめて取り出せるとデバッグに便利である。よくわからずに使っていたので、記法の意味を分解して理解する。
</p>
</div>
</div>

<div id="outline-container-org26c25bd" class="outline-2">
<h2 id="org26c25bd"><a href="#org26c25bd">動かしてみる</a></h2>
<div class="outline-text-2" id="text-org26c25bd">
<p>
まず使い方をまとめ、実行して分解を試みる。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>標準出力をファイルに出力できる</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`echo "hello" 2&gt;&amp;1`</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">result</span>
</pre>
</div>

<pre class="example">
hello
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>標準エラーをファイルに出力できる</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`aaa 2&gt;&amp;1`</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">result</span>
</pre>
</div>

<pre class="example">
/bin/bash: line 1: aaa: command not found
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>&amp;がないと1というファイルができてしまう。ファイルディスクリプタではなくファイルとして認識する</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`aaa 2&gt;1`</span>
cat 1
</pre>
</div>

<pre class="example">
/bin/bash: line 1: aaa: command not found
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>これでも書ける</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`aaa 2&gt;&amp; 1`</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">result</span>
</pre>
</div>

<pre class="example">
/bin/bash: line 1: aaa: command not found
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>&gt; の前後にスペースがあるとsyntax errorになる</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`aaa 2&gt; &amp;1`</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">result</span>
</pre>
</div>

<p>
結論、 <code>2&gt;&amp;</code> はスペースを許容せずひと塊でないといけない。意味的にもひと塊になっているはずだが、意味のつながりがよくわからない。
</p>
</div>
</div>

<div id="outline-container-orgee6eda0" class="outline-2">
<h2 id="orgee6eda0"><a href="#orgee6eda0">調べる</a></h2>
<div class="outline-text-2" id="text-orgee6eda0">
<p>
<a href="https://qiita.com/task4233/items/1f5ba68e8fed430f6f9f">Bashのリダイレクト(`&gt;`と`&gt;&amp;`)とパイプ等についてのまとめ #Bash - Qiita</a>を見てみよう。
</p>

<p>
<code>&gt;</code> はリダイレクト記法である。空のファイルを生成して書き込む。書式は <code>$ コマンド [元fd=1]&gt; 先ファイル名</code> となっている。ファイルディスクリプタ番号はデフォルトで1(標準出力)。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>等価な2つの書き方</label><pre class="src src-shell"><span class="org-builtin">echo</span> <span class="org-string">"hello1"</span> &gt; test.log
cat test.log

<span class="org-builtin">echo</span> <span class="org-string">"hello2"</span> 1&gt; test.log
cat test.log
</pre>
</div>

<pre class="example">
hello1
hello2
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 7: </span>標準エラー出力してみる</label><pre class="src src-shell">aaa 2&gt; error.log
cat error.log
</pre>
</div>

<pre class="example">
/bin/bash: line 1: aaa: command not found
</pre>

<p>
<code>&gt;&amp;</code> は他のファイルディスクリプタにリダイレクトする。 <code>$コマンド [元FD]&gt;&amp;[先FD]</code> 。&amp;がないとファイル書き込みになってしまう。つまり <code>2&gt;&amp;1</code> は標準エラー出力を標準出力にリダイレクトする。結果、標準出力に標準出力と標準エラー出力が表示できる。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>標準出力できている</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`echo hello 2&gt;&amp;1`</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">result</span>
</pre>
</div>

<pre class="example">
hello
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>標準エラー出力できている</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`aaa 2&gt;&amp;1`</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">result</span>
</pre>
</div>

<pre class="example">
/bin/bash: line 1: aaa: command not found
</pre>

<p>
リダイレクトをさらにリダイレクトできる。
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>さらにaaa.logファイルに出力する</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`echo hello 2&gt;&amp;1 &gt; aaa.log`</span>
cat aaa.log
</pre>
</div>

<pre class="example">
hello
</pre>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>捨てる</label><pre class="src src-shell"><span class="org-variable-name">result</span>=<span class="org-sh-quoted-exec">`echo hello 2&gt;&amp;1 &gt; /dev/null`</span>
<span class="org-builtin">echo</span> $<span class="org-variable-name">result</span>
</pre>
</div>

<pre class="example">

</pre>

<p>
以上より、 <code>2&gt;&amp;</code> がひと塊でないといけない理由。
</p>

<ul class="org-ul">
<li><code>2&gt;</code> の数字はリダイレクト元ファイルディスクリプタ指定。 <code>&gt;</code> は <code>1&gt;</code> が省略されているだけで、1以外には <code>2&gt;</code> と省略せずに書く必要がある。そもそもスペースは入れない記法である</li>
<li><code>&gt;&amp;</code> の <code>&amp;</code> は続くリダイレクト先がファイルディスクリプタであることを示す。 <code>&gt;</code> に続く識別子がファイル名でないのを区別するための記法なので、スペースを許容しないほうが意味が明確である。ファイル名は <code>&amp;</code> がくる可能性があり、そのとき意味が不明瞭になる</li>
</ul>
</div>
</div>

<div id="outline-container-orge514765" class="outline-2">
<h2 id="orge514765"><a href="#orge514765">参考</a></h2>
<div class="outline-text-2" id="text-orge514765">
<ul class="org-ul">
<li><a href="https://qiita.com/task4233/items/1f5ba68e8fed430f6f9f">Bashのリダイレクト(`&gt;`と`&gt;&amp;`)とパイプ等についてのまとめ #Bash - Qiita</a>。わかりやすかった</li>
</ul>
</div>
</div>

<div id="outline-container-org176bdfc" class="outline-2">
<h2 id="org176bdfc"><a href="#org176bdfc">関連</a></h2>
<div class="outline-text-2" id="text-org176bdfc">
<p>
なし。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<footer class="footer py-3"><div class="container"><div class="row "><div class="col-md-4"></div><div class="col-sm col-md"><nav class="navbar"><a class="nav-link text-secondary small px-0" href="./index.html">Insomnia</a><a class="nav-link text-secondary small px-0" href="./sitemap.html">Sitemap</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD/roam">Repository</a><a class="nav-link text-secondary small px-0" href="https://github.com/kijimaD">@kijimaD</a></nav></div><div class="col-md-4"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"/>
</div>
</body>
</html>
